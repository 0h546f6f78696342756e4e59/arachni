<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module: Arachni::Module::Auditor</title>
<link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (A)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../Arachni.html" title="Arachni (module)">Arachni</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Module.html" title="Arachni::Module (module)">Module</a></span></span>
     &raquo; 
    <span class="title">Auditor</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Module: Arachni::Module::Auditor
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
    <dt class="r1">Included in:</dt>
    <dd class="r1"><span class='object_link'><a href="Base.html" title="Arachni::Module::Base (class)">Base</a></span></dd>
    
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/module/auditor.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
Auditor module
</p>
<p>
Included by <span class='object_link'><a href="Base.html" title="Arachni::Module::Base (class)">Base</a></span> and provides abstract audit methods.
</p>
<p>
There are 3 main types of audit techniques available:
</p>
<ul>
<li><p>
Pattern matching &#8212; <span class='object_link'><a href="#audit-instance_method" title="Arachni::Module::Auditor#audit (method)">#audit</a></span>
</p>
</li>
<li><p>
Timing attacks &#8212; <span class='object_link'><a href="#audit_timeout-instance_method" title="Arachni::Module::Auditor#audit_timeout (method)">#audit_timeout</a></span>
</p>
</li>
<li><p>
Differential analysis attacks &#8212; <span class='object_link'><a href="#audit_rdiff-instance_method" title="Arachni::Module::Auditor#audit_rdiff (method)">#audit_rdiff</a></span>
</p>
</li>
</ul>
<p>
@author: Tasos &#8220;Zapotek&#8221; Laskos
</p>
<pre class="code">
                                     &lt;tasos.laskos@gmail.com&gt;
                                     &lt;zapotek@segfault.gr&gt;
</pre>
<p>
@version: 0.3
</p>


  </div>
</div>
<div class="tags">
  
</div><h2>Defined Under Namespace</h2>
<p class="children">
   
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Auditor/Element.html" title="Arachni::Module::Auditor::Element (module)">Element</a></span>, <span class='object_link'><a href="Auditor/Format.html" title="Arachni::Module::Auditor::Format (module)">Format</a></span>
    
   
    
  
</p>

  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="OPTIONS-constant" class="">OPTIONS =
          <div class="docstring">
  <div class="discussion">
    <p>
Default audit options.
</p>


  </div>
</div>
<div class="tags">
  
</div>
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span>

    <span class='comment'>#
</span>    <span class='comment'># Elements to audit.
</span>    <span class='comment'>#
</span>    <span class='comment'># Only required when calling {#audit}.&lt;br/&gt;
</span>    <span class='comment'># If no elements have been passed to audit it will
</span>    <span class='comment'># use the elements in {#self.info}.
</span>    <span class='comment'>#
</span>    <span class='symbol'>:elements</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span> <span class='const'>Element</span><span class='op'>::</span><span class='const'>LINK</span><span class='comma'>,</span> <span class='const'>Element</span><span class='op'>::</span><span class='const'>FORM</span><span class='comma'>,</span>
                   <span class='const'>Element</span><span class='op'>::</span><span class='const'>COOKIE</span><span class='comma'>,</span> <span class='const'>Element</span><span class='op'>::</span><span class='const'>HEADER</span><span class='comma'>,</span>
                   <span class='const'>Issue</span><span class='op'>::</span><span class='const'>Element</span><span class='op'>::</span><span class='const'>BODY</span> <span class='rbracket'>]</span><span class='comma'>,</span>

    <span class='comment'>#
</span>    <span class='comment'># The regular expression to match against the response body.
</span>    <span class='comment'>#
</span>    <span class='symbol'>:regexp</span>   <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span>

    <span class='comment'>#
</span>    <span class='comment'># Verify the matched string with this value.
</span>    <span class='comment'>#
</span>    <span class='symbol'>:match</span>    <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span>

    <span class='comment'>#
</span>    <span class='comment'># Formatting of the injection strings.
</span>    <span class='comment'>#
</span>    <span class='comment'># A new set of audit inputs will be generated
</span>    <span class='comment'># for each value in the array.
</span>    <span class='comment'>#
</span>    <span class='comment'># Values can be OR'ed bitfields of all available constants
</span>    <span class='comment'># of {Auditor::Format}.
</span>    <span class='comment'>#
</span>    <span class='comment'># @see  Auditor::Format
</span>    <span class='comment'>#
</span>    <span class='symbol'>:format</span>   <span class='op'>=&gt;</span> <span class='lbracket'>[</span> <span class='const'>Format</span><span class='op'>::</span><span class='const'>STRAIGHT</span><span class='comma'>,</span> <span class='const'>Format</span><span class='op'>::</span><span class='const'>APPEND</span><span class='comma'>,</span>
                   <span class='const'>Format</span><span class='op'>::</span><span class='const'>NULL</span><span class='comma'>,</span> <span class='const'>Format</span><span class='op'>::</span><span class='const'>APPEND</span> <span class='op'>|</span> <span class='const'>Format</span><span class='op'>::</span><span class='const'>NULL</span> <span class='rbracket'>]</span><span class='comma'>,</span>

    <span class='comment'>#
</span>    <span class='comment'># If 'train' is set to true the HTTP response will be
</span>    <span class='comment'># analyzed for new elements. &lt;br/&gt;
</span>    <span class='comment'># Be carefull when enabling it, there'll be a performance penalty.
</span>    <span class='comment'>#
</span>    <span class='comment'># When the Auditor submits a form with original or sample values
</span>    <span class='comment'># this option will be overriden to true.
</span>    <span class='comment'>#
</span>    <span class='symbol'>:train</span>     <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>

    <span class='comment'>#
</span>    <span class='comment'># Enable skipping of already audited inputs
</span>    <span class='comment'>#
</span>    <span class='symbol'>:redundant</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>

    <span class='comment'>#
</span>    <span class='comment'># Make requests asynchronously
</span>    <span class='comment'>#
</span>    <span class='symbol'>:async</span>     <span class='op'>=&gt;</span> <span class='kw'>true</span>
<span class='rbrace'>}</span></pre></dd>
      
    </dl>
  



  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#audit_timeout_phase_2-class_method" title="audit_timeout_phase_2 (class method)">+ (Object) <strong>audit_timeout_phase_2</strong>(elem) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Runs phase 2 of the timing attack auditng an individual element (which
passed phase 1) with a higher delay and timeout.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#audit_timeout_stabilize-class_method" title="audit_timeout_stabilize (class method)">+ (Object) <strong>audit_timeout_stabilize</strong>(elem) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Submits an element which has just been audited using a timing attack with a
high timeout in order to determine when the effects of a timing attack has
worn off in order to safely continue the audit.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#included-class_method" title="included (class method)">+ (Object) <strong>included</strong>(mod) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#timeout_audit_blocks-class_method" title="timeout_audit_blocks (class method)">+ (Queue) <strong>timeout_audit_blocks</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Holds timing-attack performing Procs to be run after all non-tming-attack
modules have finished.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#timeout_audit_run-class_method" title="timeout_audit_run (class method)">+ (Object) <strong>timeout_audit_run</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Runs all blocks in <span class='object_link'><a href="#timeout_audit_blocks-class_method" title="Arachni::Module::Auditor.timeout_audit_blocks (method)">timeout_audit_blocks</a></span> and verifies and logs the
candidate elements.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#timeout_loaded_modules-class_method" title="timeout_loaded_modules (class method)">+ (Set) <strong>timeout_loaded_modules</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the names of all loaded modules that use timing attacks.
</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#__rdiff_audit_id-instance_method" title="#__rdiff_audit_id (instance method)">- (Object) <strong>__rdiff_audit_id</strong>(elem) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#__rdiff_audited%21-instance_method" title="#__rdiff_audited! (instance method)">- (Object) <strong>__rdiff_audited!</strong>(elem) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#__rdiff_audited%3F-instance_method" title="#__rdiff_audited? (instance method)">- (Boolean) <strong>__rdiff_audited?</strong>(elem) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#audit-instance_method" title="#audit (instance method)">- (Object) <strong>audit</strong>(injection_str, opts = { }, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Provides easy access to element auditing using simple injection and pattern
matching.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#audit_elems-instance_method" title="#audit_elems (instance method)">- (Object) <strong>audit_elems</strong>(elements, injection_str, opts = { }, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Audits Auditalble HTML/HTTP elements.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#audit_rdiff-instance_method" title="#audit_rdiff (instance method)">- (Object) <strong>audit_rdiff</strong>(opts = {}, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Audits all elements types in opts[:elements] (or self.class.info[:elements]
if there are none in opts) using differential analysis attacks.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#audit_rdiff_elem-instance_method" title="#audit_rdiff_elem (instance method)">- (Object) <strong>audit_rdiff_elem</strong>(elem, opts = {}, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Audits a single element using an rdiff attack.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#audit_timeout-instance_method" title="#audit_timeout (instance method)">- (Object) <strong>audit_timeout</strong>(strings, opts) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Audits elements using timing attacks and automatically logs results.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#audit_timeout_debug_msg-instance_method" title="#audit_timeout_debug_msg (instance method)">- (Object) <strong>audit_timeout_debug_msg</strong>(phase, delay) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#log-instance_method" title="#log (instance method)">- (Object) <strong>log</strong>(opts, res = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Populates and logs an <span class='object_link'><a href="../Issue.html" title="Arachni::Issue (class)">Issue</a></span> based on data from
&#8220;opts&#8221; and &#8220;res&#8221;.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#match_and_log-instance_method" title="#match_and_log (instance method)">- (Object) <strong>match_and_log</strong>(regexps, string = @page.html, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Matches the &#8220;string&#8221; (default string is the HTML code in
@page.html) to an array of regular expressions and logs the results.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#method_missing-instance_method" title="#method_missing (instance method)">- (Object) <strong>method_missing</strong>(sym, *args, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Provides the following methods:
</p>
<ul>
<li><p>
audit_links()
</p>
</li>
<li><p>
audit_forms()
</p>
</li>
<li><p>
audit_cookies()
</p>
</li>
<li><p>
audit_headers().
</p>
</li>
</ul>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#skip%3F-instance_method" title="#skip? (instance method)">- (Boolean) <strong>skip?</strong>(elem) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
This is called right before an [Arachni::Parser::Element] is
submitted/auditted and is used to determine whether to skip it or not.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#timing_attack-instance_method" title="#timing_attack (instance method)">- (Object) <strong>timing_attack</strong>(strings, opts, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Audits elements using a timing attack.
</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="method_missing_details" class="method_details_list">
  <h2>Dynamic Method Handling</h2>
  <p class="notice this">
    This class handles dynamic methods through the <tt>method_missing</tt> method
    
  </p>
  
    <div class="method_details first">
  <p class="signature first" id="method_missing-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>method_missing</strong>(sym, *args, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Provides the following methods:
</p>
<ul>
<li><p>
audit_links()
</p>
</li>
<li><p>
audit_forms()
</p>
</li>
<li><p>
audit_cookies()
</p>
</li>
<li><p>
audit_headers()
</p>
</li>
</ul>
<p>
Metaprogrammed to avoid redundant code while maintaining compatibility and
method shortcuts.
</p>


  </div>
</div>
<div class="tags">
  <h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>NoMethodError</tt>)</span>
      
      
      
      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><span class='object_link'><a href="#audit_elems-instance_method" title="Arachni::Module::Auditor#audit_elems (method)">#audit_elems</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


860
861
862
863
864
865
866
867
868
869
870
871
872
873
874</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 860</span>

<span class='kw'>def</span> <span class='id method_missing'>method_missing</span><span class='lparen'>(</span> <span class='id sym'>sym</span><span class='comma'>,</span> <span class='op'>*</span><span class='id args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>

    <span class='id elem'>elem</span> <span class='op'>=</span> <span class='id sym'>sym</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='period'>.</span><span class='id gsub!'>gsub!</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>audit_</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>@</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span>
    <span class='id raise'>raise</span> <span class='const'>NoMethodError</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Undefined method '</span><span class='embexpr_beg'>#{</span><span class='id sym'>sym</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_content'>'.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id sym'>sym</span><span class='comma'>,</span> <span class='id args'>args</span> <span class='rparen'>)</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id elem'>elem</span>

    <span class='id elems'>elems</span> <span class='op'>=</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id instance_variable_get'>instance_variable_get</span><span class='lparen'>(</span> <span class='id elem'>elem</span> <span class='rparen'>)</span>

    <span class='kw'>if</span><span class='lparen'>(</span> <span class='id elems'>elems</span> <span class='op'>&amp;&amp;</span> <span class='id elem'>elem</span> <span class='rparen'>)</span>
        <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Missing required argument 'injection_str'</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> for audit_</span><span class='embexpr_beg'>#{</span><span class='id elem'>elem</span><span class='period'>.</span><span class='id gsub'>gsub</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>@</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span><span class='rbrace'>}</span><span class='tstring_content'>().</span><span class='tstring_end'>&quot;</span></span> <span class='rparen'>)</span> <span class='kw'>if</span><span class='lparen'>(</span> <span class='op'>!</span><span class='id args'>args</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='rparen'>)</span>
        <span class='id audit_elems'>audit_elems</span><span class='lparen'>(</span> <span class='id elems'>elems</span><span class='comma'>,</span> <span class='id args'>args</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id args'>args</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>?</span> <span class='id args'>args</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='op'>:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>
    <span class='kw'>else</span>
        <span class='id raise'>raise</span> <span class='const'>NoMethodError</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Undefined method '</span><span class='embexpr_beg'>#{</span><span class='id sym'>sym</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_content'>'.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id sym'>sym</span><span class='comma'>,</span> <span class='id args'>args</span> <span class='rparen'>)</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="audit_timeout_phase_2-class_method">
  
    + (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>audit_timeout_phase_2</strong>(elem) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Runs phase 2 of the timing attack auditng an individual element (which
passed phase 1) with a higher delay and timeout
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 459</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id audit_timeout_phase_2'>audit_timeout_phase_2</span><span class='lparen'>(</span> <span class='id elem'>elem</span> <span class='rparen'>)</span>

    <span class='comment'># reset the audited list since we're going to re-audit the elements
</span>    <span class='comment'># @@__timeout_audited = Set.new
</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='id elem'>elem</span><span class='period'>.</span><span class='id opts'>opts</span>
    <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:timeout</span><span class='rbracket'>]</span> <span class='op'>*=</span> <span class='int'>2</span>
    <span class='comment'># opts[:async]    = false
</span>    <span class='comment'># self.audit_timeout_debug_msg( 2, opts[:timeout] )
</span>
    <span class='id str'>str</span> <span class='op'>=</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:timing_string</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id gsub'>gsub</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>__TIME__</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
        <span class='lparen'>(</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:timeout</span><span class='rbracket'>]</span> <span class='op'>/</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:timeout_divider</span><span class='rbracket'>]</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='rparen'>)</span>

    <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:timeout</span><span class='rbracket'>]</span> <span class='op'>*=</span> <span class='float'>0.7</span>

    <span class='id elem'>elem</span><span class='period'>.</span><span class='id auditable'>auditable</span> <span class='op'>=</span> <span class='id elem'>elem</span><span class='period'>.</span><span class='id orig'>orig</span>

    <span class='comment'># this is the control; request the URL of the element to make sure
</span>    <span class='comment'># that the web page is alive i.e won't time-out by default
</span>    <span class='id elem'>elem</span><span class='period'>.</span><span class='id get_auditor'>get_auditor</span><span class='period'>.</span><span class='id http'>http</span><span class='period'>.</span><span class='id get'>get</span><span class='lparen'>(</span> <span class='id elem'>elem</span><span class='period'>.</span><span class='id action'>action</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id on_complete'>on_complete</span> <span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id res'>res</span><span class='op'>|</span>

        <span class='kw'>if</span> <span class='op'>!</span><span class='id res'>res</span><span class='period'>.</span><span class='id timed_out?'>timed_out?</span>

            <span class='id elem'>elem</span><span class='period'>.</span><span class='id get_auditor'>get_auditor</span><span class='period'>.</span><span class='id print_info'>print_info</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Liveness check was successful, progressing to verification...</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span>

            <span class='id elem'>elem</span><span class='period'>.</span><span class='id audit'>audit</span><span class='lparen'>(</span> <span class='id str'>str</span><span class='comma'>,</span> <span class='id opts'>opts</span> <span class='rparen'>)</span> <span class='lbrace'>{</span>
                <span class='op'>|</span><span class='id res'>res</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='op'>|</span>

                <span class='kw'>if</span> <span class='id res'>res</span><span class='period'>.</span><span class='id timed_out?'>timed_out?</span>

                    <span class='comment'># all issues logged by timing attacks need manual verification.
</span>                    <span class='comment'># end of story.
</span>                    <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:verification</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span>
                    <span class='id elem'>elem</span><span class='period'>.</span><span class='id get_auditor'>get_auditor</span><span class='period'>.</span><span class='id log'>log</span><span class='lparen'>(</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='id res'>res</span><span class='rparen'>)</span>

                    <span class='kw'>self</span><span class='period'>.</span><span class='id audit_timeout_stabilize'>audit_timeout_stabilize</span><span class='lparen'>(</span> <span class='id elem'>elem</span> <span class='rparen'>)</span>

                <span class='kw'>else</span>
                    <span class='id elem'>elem</span><span class='period'>.</span><span class='id get_auditor'>get_auditor</span><span class='period'>.</span><span class='id print_info'>print_info</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Verification failed.</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span>
                <span class='kw'>end</span>
            <span class='rbrace'>}</span>
        <span class='kw'>else</span>
            <span class='id elem'>elem</span><span class='period'>.</span><span class='id get_auditor'>get_auditor</span><span class='period'>.</span><span class='id print_info'>print_info</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Liveness check failed, bailing out...</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span>
        <span class='kw'>end</span>
    <span class='rbrace'>}</span>

    <span class='id elem'>elem</span><span class='period'>.</span><span class='id get_auditor'>get_auditor</span><span class='period'>.</span><span class='id http'>http</span><span class='period'>.</span><span class='id run'>run</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="audit_timeout_stabilize-class_method">
  
    + (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>audit_timeout_stabilize</strong>(elem) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Submits an element which has just been audited using a timing attack with a
high timeout in order to determine when the effects of a timing attack has
worn off in order to safely continue the audit.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../Element/Auditable.html" title="Arachni::Element::Auditable (class)">Arachni::Element::Auditable</a></span></tt>)</span>
      
      
        <span class='name'>elem</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 516</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id audit_timeout_stabilize'>audit_timeout_stabilize</span><span class='lparen'>(</span> <span class='id elem'>elem</span> <span class='rparen'>)</span>

    <span class='id d_opts'>d_opts</span> <span class='op'>=</span> <span class='lbrace'>{</span>
        <span class='symbol'>:skip_orig</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
        <span class='symbol'>:redundant</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
        <span class='symbol'>:timeout</span>   <span class='op'>=&gt;</span> <span class='int'>120000</span><span class='comma'>,</span>
        <span class='symbol'>:silent</span>    <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
        <span class='symbol'>:async</span>     <span class='op'>=&gt;</span> <span class='kw'>false</span>
    <span class='rbrace'>}</span>

    <span class='id orig_opts'>orig_opts</span> <span class='op'>=</span> <span class='id elem'>elem</span><span class='period'>.</span><span class='id opts'>opts</span>

    <span class='id elem'>elem</span><span class='period'>.</span><span class='id get_auditor'>get_auditor</span><span class='period'>.</span><span class='id print_info'>print_info</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Waiting for the effects of the timing attack to wear off.</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span>
    <span class='id elem'>elem</span><span class='period'>.</span><span class='id get_auditor'>get_auditor</span><span class='period'>.</span><span class='id print_info'>print_info</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Max waiting time: </span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='lparen'>(</span> <span class='id d_opts'>d_opts</span><span class='lbracket'>[</span><span class='symbol'>:timeout</span><span class='rbracket'>]</span> <span class='op'>/</span><span class='int'>1000</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'> seconds.</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span>

    <span class='id elem'>elem</span><span class='period'>.</span><span class='id auditable'>auditable</span> <span class='op'>=</span> <span class='id elem'>elem</span><span class='period'>.</span><span class='id orig'>orig</span>
    <span class='id res'>res</span> <span class='op'>=</span> <span class='id elem'>elem</span><span class='period'>.</span><span class='id submit'>submit</span><span class='lparen'>(</span> <span class='id d_opts'>d_opts</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id response'>response</span>

    <span class='kw'>if</span> <span class='op'>!</span><span class='id res'>res</span><span class='period'>.</span><span class='id timed_out?'>timed_out?</span>
        <span class='id elem'>elem</span><span class='period'>.</span><span class='id get_auditor'>get_auditor</span><span class='period'>.</span><span class='id print_info'>print_info</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Server seems responsive again.</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span>
    <span class='kw'>else</span>
        <span class='id elem'>elem</span><span class='period'>.</span><span class='id get_auditor'>get_auditor</span><span class='period'>.</span><span class='id print_error'>print_error</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Max waiting time exceeded, the server may be dead.</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id elem'>elem</span><span class='period'>.</span><span class='id opts'>opts</span><span class='period'>.</span><span class='id merge!'>merge!</span><span class='lparen'>(</span> <span class='id orig_opts'>orig_opts</span> <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="included-class_method">
  
    + (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>included</strong>(mod) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 32</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id included'>included</span><span class='lparen'>(</span> <span class='id mod'>mod</span> <span class='rparen'>)</span>
    <span class='comment'># @@__timeout_audited      ||= Set.new
</span>
    <span class='comment'># holds timing-attack performing Procs to be run after all
</span>    <span class='comment'># non-tming-attack modules have finished.
</span>    <span class='cvar'>@@__timeout_audit_blocks</span>   <span class='op'>||=</span> <span class='const'>Queue</span><span class='period'>.</span><span class='id new'>new</span>

    <span class='comment'># populated by timing attack phase 1 with
</span>    <span class='comment'># candidate elements to be verified by phase 2
</span>    <span class='cvar'>@@__timeout_candidates</span>     <span class='op'>||=</span> <span class='const'>Queue</span><span class='period'>.</span><span class='id new'>new</span>

    <span class='comment'># modules which have called the timing attack audit mthod (audit_timeout)
</span>    <span class='comment'># we're interested in the amount, not the names, and is used to
</span>    <span class='comment'># determine scan progress
</span>    <span class='cvar'>@@__timeout_loaded_modules</span> <span class='op'>||=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id new'>new</span>

    <span class='comment'># the rdiff attack performs it own redundancy checks so we need this to
</span>    <span class='comment'># keep track audited elements
</span>    <span class='cvar'>@@__rdiff_audited</span> <span class='op'>||=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id new'>new</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="timeout_audit_blocks-class_method">
  
    + (<tt>Queue</tt>) <strong>timeout_audit_blocks</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Holds timing-attack performing Procs to be run after all non-tming-attack
modules have finished.
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Queue</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


437
438
439</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 437</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id timeout_audit_blocks'>timeout_audit_blocks</span>
    <span class='cvar'>@@__timeout_audit_blocks</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="timeout_audit_run-class_method">
  
    + (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>timeout_audit_run</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Runs all blocks in <span class='object_link'><a href="#timeout_audit_blocks-class_method" title="Arachni::Module::Auditor.timeout_audit_blocks (method)">timeout_audit_blocks</a></span> and verifies and logs the
candidate elements.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


445
446
447
448
449
450
451
452
453</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 445</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id timeout_audit_run'>timeout_audit_run</span>
    <span class='kw'>while</span><span class='lparen'>(</span> <span class='op'>!</span><span class='cvar'>@@__timeout_audit_blocks</span><span class='period'>.</span><span class='id empty?'>empty?</span> <span class='rparen'>)</span>
        <span class='cvar'>@@__timeout_audit_blocks</span><span class='period'>.</span><span class='id pop'>pop</span><span class='period'>.</span><span class='id call'>call</span>
    <span class='kw'>end</span>

    <span class='kw'>while</span><span class='lparen'>(</span> <span class='op'>!</span><span class='cvar'>@@__timeout_candidates</span><span class='period'>.</span><span class='id empty?'>empty?</span> <span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id audit_timeout_phase_2'>audit_timeout_phase_2</span><span class='lparen'>(</span> <span class='cvar'>@@__timeout_candidates</span><span class='period'>.</span><span class='id pop'>pop</span> <span class='rparen'>)</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="timeout_loaded_modules-class_method">
  
    + (<tt>Set</tt>) <strong>timeout_loaded_modules</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the names of all loaded modules that use timing attacks.
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Set</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


427
428
429</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 427</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id timeout_loaded_modules'>timeout_loaded_modules</span>
    <span class='cvar'>@@__timeout_loaded_modules</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="__rdiff_audit_id-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>__rdiff_audit_id</strong>(elem) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


844
845
846</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 844</span>

<span class='kw'>def</span> <span class='id __rdiff_audit_id'>__rdiff_audit_id</span><span class='lparen'>(</span> <span class='id elem'>elem</span> <span class='rparen'>)</span>
    <span class='id elem'>elem</span><span class='period'>.</span><span class='id action'>action</span> <span class='op'>+</span> <span class='id elem'>elem</span><span class='period'>.</span><span class='id auditable'>auditable</span><span class='period'>.</span><span class='id keys'>keys</span><span class='period'>.</span><span class='id to_s'>to_s</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="__rdiff_audited!-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>__rdiff_audited!</strong>(elem) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


836
837
838</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 836</span>

<span class='kw'>def</span> <span class='id __rdiff_audited!'>__rdiff_audited!</span><span class='lparen'>(</span> <span class='id elem'>elem</span> <span class='rparen'>)</span>
    <span class='cvar'>@@__rdiff_audited</span> <span class='op'>&lt;&lt;</span> <span class='id __rdiff_audit_id'>__rdiff_audit_id</span><span class='lparen'>(</span> <span class='id elem'>elem</span> <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="__rdiff_audited?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>__rdiff_audited?</strong>(elem) 
  

  
</p><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


840
841
842</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 840</span>

<span class='kw'>def</span> <span class='id __rdiff_audited?'>__rdiff_audited?</span><span class='lparen'>(</span> <span class='id elem'>elem</span> <span class='rparen'>)</span>
    <span class='cvar'>@@__rdiff_audited</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span> <span class='id __rdiff_audit_id'>__rdiff_audit_id</span><span class='lparen'>(</span> <span class='id elem'>elem</span> <span class='rparen'>)</span> <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="audit-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>audit</strong>(injection_str, opts = { }, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Provides easy access to element auditing using simple injection and pattern
matching.
</p>
<p>
If a block has been provided analysis and logging will be delegated to it,
otherwise, if a match is found it will be automatically logged.
</p>
<p>
If no elements have been specified in &#8216;opts&#8217; it will use the
elements from the module&#8217;s &#8220;self.info()&#8221; hash. <br/> If
no elements have been specified in &#8216;opts&#8217; or
&#8220;self.info()&#8221; it will use the elements in <span class='object_link'><a href="#OPTIONS-constant" title="Arachni::Module::Auditor::OPTIONS (constant)">OPTIONS</a></span>. <br/>
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
        <span class='name'>injection_str</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the string to be injected
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>opts</span>
      
      
        <em class="default">(defaults to: <tt>{ }</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
options as described in <span class='object_link'><a href="#OPTIONS-constant" title="Arachni::Module::Auditor::OPTIONS (constant)">OPTIONS</a></span>
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Block</tt>)</span>
      
      
        <span class='name'>&amp;block</span>
      
      
      
        &mdash;
        <div class='inline'><p>
block to be used for custom analysis of responses; will be passed the
following:
</p>
<ul>
<li><p>
HTTP response
</p>
</li>
<li><p>
options
</p>
</li>
<li><p>
element
</p>
</li>
</ul>
<p>
The block will be called as soon as the HTTP response is received.
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 298</span>

<span class='kw'>def</span> <span class='id audit'>audit</span><span class='lparen'>(</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>

    <span class='kw'>if</span><span class='lparen'>(</span> <span class='op'>!</span><span class='id opts'>opts</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span> <span class='symbol'>:elements</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>!</span><span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id empty?'>empty?</span> <span class='rparen'>)</span>
        <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='period'>.</span><span class='id info'>info</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span><span class='lparen'>(</span> <span class='op'>!</span><span class='id opts'>opts</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span> <span class='symbol'>:elements</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>!</span><span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id empty?'>empty?</span> <span class='rparen'>)</span>
        <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>OPTIONS</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='id opts'>opts</span>  <span class='op'>=</span> <span class='const'>OPTIONS</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span> <span class='id opts'>opts</span> <span class='rparen'>)</span>

    <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id elem'>elem</span><span class='op'>|</span>

        <span class='kw'>case</span> <span class='id elem'>elem</span>

            <span class='kw'>when</span>  <span class='const'>Element</span><span class='op'>::</span><span class='const'>LINK</span>
                <span class='id audit_links'>audit_links</span><span class='lparen'>(</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>

            <span class='kw'>when</span>  <span class='const'>Element</span><span class='op'>::</span><span class='const'>FORM</span>
                <span class='id audit_forms'>audit_forms</span><span class='lparen'>(</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>

            <span class='kw'>when</span>  <span class='const'>Element</span><span class='op'>::</span><span class='const'>COOKIE</span>
                <span class='id audit_cookies'>audit_cookies</span><span class='lparen'>(</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>

            <span class='kw'>when</span>  <span class='const'>Element</span><span class='op'>::</span><span class='const'>HEADER</span>
                <span class='id audit_headers'>audit_headers</span><span class='lparen'>(</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>
            <span class='kw'>else</span>
                <span class='id raise'>raise</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Unknown element to audit:  </span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id elem'>elem</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='rparen'>)</span>

        <span class='kw'>end</span>

    <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="audit_elems-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>audit_elems</strong>(elements, injection_str, opts = { }, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Audits Auditalble HTML/HTTP elements
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="../Element/Auditable.html" title="Arachni::Element::Auditable (class)">Arachni::Element::Auditable</a></span>&gt;</tt>)</span>
      
      
        <span class='name'>elements</span>
      
      
      
        &mdash;
        <div class='inline'><p>
elements to audit
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
        <span class='name'>injection_str</span>
      
      
      
        &mdash;
        <div class='inline'><p>
same as for <span class='object_link'><a href="#audit-instance_method" title="Arachni::Module::Auditor#audit (method)">#audit</a></span>
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>opts</span>
      
      
        <em class="default">(defaults to: <tt>{ }</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
same as for <span class='object_link'><a href="#audit-instance_method" title="Arachni::Module::Auditor#audit (method)">#audit</a></span>
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Block</tt>)</span>
      
      
        <span class='name'>&amp;block</span>
      
      
      
        &mdash;
        <div class='inline'><p>
same as for <span class='object_link'><a href="#audit-instance_method" title="Arachni::Module::Auditor#audit (method)">#audit</a></span>
</p>
</div>
      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><span class='object_link'><a href="#method_missing-instance_method" title="Arachni::Module::Auditor#method_missing (method)">#method_missing</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


886
887
888
889
890
891
892
893
894
895
896
897
898</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 886</span>

<span class='kw'>def</span> <span class='id audit_elems'>audit_elems</span><span class='lparen'>(</span> <span class='id elements'>elements</span><span class='comma'>,</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>

    <span class='id opts'>opts</span>            <span class='op'>=</span> <span class='const'>OPTIONS</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span> <span class='id opts'>opts</span> <span class='rparen'>)</span>
    <span class='id url'>url</span>             <span class='op'>=</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id url'>url</span>

    <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:injected_orig</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id injection_str'>injection_str</span>

    <span class='id elements'>elements</span><span class='period'>.</span><span class='id each'>each</span><span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id elem'>elem</span><span class='op'>|</span>
        <span class='id elem'>elem</span><span class='period'>.</span><span class='id auditor'>auditor</span><span class='lparen'>(</span> <span class='kw'>self</span> <span class='rparen'>)</span>
        <span class='id elem'>elem</span><span class='period'>.</span><span class='id audit'>audit</span><span class='lparen'>(</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>
    <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="audit_rdiff-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>audit_rdiff</strong>(opts = {}, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Audits all elements types in opts[:elements] (or self.class.info[:elements]
if there are none in opts) using differential analysis attacks.
</p>
<pre class="code">
   <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span>
       <span class='symbol'>:precision</span> <span class='op'>=&gt;</span> <span class='int'>3</span><span class='comma'>,</span>
       <span class='symbol'>:faults</span>    <span class='op'>=&gt;</span> <span class='lbracket'>[</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>fault injections</span><span class='tstring_end'>'</span></span> <span class='rbracket'>]</span><span class='comma'>,</span>
       <span class='symbol'>:bools</span>     <span class='op'>=&gt;</span> <span class='lbracket'>[</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>boolean injections</span><span class='tstring_end'>'</span></span> <span class='rbracket'>]</span>
   <span class='rbrace'>}</span>

   <span class='id audit_rdiff'>audit_rdiff</span><span class='lparen'>(</span> <span class='id opts'>opts</span> <span class='rparen'>)</span>
</pre>
<p>
Here&#8217;s how it goes:
</p>
<pre class="code">
  let default be the default/original response
  let fault   be the response of the fault injection
  let bool    be the response of the boolean injection

  a vulnerability is logged if default == bool AND bool.code == 200 AND fault != bool
</pre>
<p>
The &#8220;bool&#8221; response is also checked in order to determine if
it&#8217;s a custom 404, if it is it&#8217;ll be skipped.
</p>
<p>
If a block has been provided analysis and logging will be delegated to it.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>opts</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
available options:
</p>
<ul>
<li><p>
:format &#8212; as seen in <span class='object_link'><a href="#OPTIONS-constant" title="Arachni::Module::Auditor::OPTIONS (constant)">OPTIONS</a></span>
</p>
</li>
<li><p>
:elements &#8212; as seen in <span class='object_link'><a href="#OPTIONS-constant" title="Arachni::Module::Auditor::OPTIONS (constant)">OPTIONS</a></span>
</p>
</li>
<li><p>
:train &#8212; as seen in <span class='object_link'><a href="#OPTIONS-constant" title="Arachni::Module::Auditor::OPTIONS (constant)">OPTIONS</a></span>
</p>
</li>
<li><p>
:precision &#8212; amount of rdiff iterations
</p>
</li>
<li><p>
:faults &#8212; array of fault injection strings (these are supposed to
force erroneous conditions when interpreted)
</p>
</li>
<li><p>
:bools &#8212; array of boolean injection strings (these are supposed to
not alter the webapp behavior when interpreted)
</p>
</li>
</ul>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Block</tt>)</span>
      
      
        <span class='name'>&amp;block</span>
      
      
      
        &mdash;
        <div class='inline'><p>
block to be used for custom analysis of responses; will be passed the
following:
</p>
<ul>
<li><p>
injected string
</p>
</li>
<li><p>
audited element
</p>
</li>
<li><p>
default response body
</p>
</li>
<li><p>
boolean response
</p>
</li>
<li><p>
fault injection response body
</p>
</li>
</ul>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 620</span>

<span class='kw'>def</span> <span class='id audit_rdiff'>audit_rdiff</span><span class='lparen'>(</span> <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>

    <span class='kw'>if</span><span class='lparen'>(</span> <span class='op'>!</span><span class='id opts'>opts</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span> <span class='symbol'>:elements</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>!</span><span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id empty?'>empty?</span> <span class='rparen'>)</span>
        <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='period'>.</span><span class='id info'>info</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span><span class='lparen'>(</span> <span class='op'>!</span><span class='id opts'>opts</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span> <span class='symbol'>:elements</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>!</span><span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id empty?'>empty?</span> <span class='rparen'>)</span>
        <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>OPTIONS</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span>
        <span class='comment'># append our seeds to the default values
</span>        <span class='symbol'>:format</span>      <span class='op'>=&gt;</span> <span class='lbracket'>[</span> <span class='const'>Format</span><span class='op'>::</span><span class='const'>APPEND</span> <span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='comment'># allow duplicate requests
</span>        <span class='symbol'>:redundant</span>   <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
        <span class='comment'># amound of rdiff iterations
</span>        <span class='symbol'>:precision</span>   <span class='op'>=&gt;</span> <span class='int'>2</span>
    <span class='rbrace'>}</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span> <span class='id opts'>opts</span> <span class='rparen'>)</span>

    <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id elem'>elem</span><span class='op'>|</span>

        <span class='kw'>case</span> <span class='id elem'>elem</span>

            <span class='kw'>when</span>  <span class='const'>Element</span><span class='op'>::</span><span class='const'>LINK</span>
                <span class='kw'>next</span> <span class='kw'>if</span> <span class='op'>!</span><span class='const'>Options</span><span class='period'>.</span><span class='id instance'>instance</span><span class='period'>.</span><span class='id audit_links'>audit_links</span>
                <span class='ivar'>@page</span><span class='period'>.</span><span class='id links'>links</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
                    <span class='op'>|</span><span class='id elem'>elem</span><span class='op'>|</span>
                    <span class='id audit_rdiff_elem'>audit_rdiff_elem</span><span class='lparen'>(</span> <span class='id elem'>elem</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>
                <span class='rbrace'>}</span>

            <span class='kw'>when</span>  <span class='const'>Element</span><span class='op'>::</span><span class='const'>FORM</span>
                <span class='kw'>next</span> <span class='kw'>if</span> <span class='op'>!</span><span class='const'>Options</span><span class='period'>.</span><span class='id instance'>instance</span><span class='period'>.</span><span class='id audit_forms'>audit_forms</span>
                <span class='ivar'>@page</span><span class='period'>.</span><span class='id forms'>forms</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
                    <span class='op'>|</span><span class='id elem'>elem</span><span class='op'>|</span>
                    <span class='id audit_rdiff_elem'>audit_rdiff_elem</span><span class='lparen'>(</span> <span class='id elem'>elem</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>
                <span class='rbrace'>}</span>

            <span class='kw'>when</span>  <span class='const'>Element</span><span class='op'>::</span><span class='const'>COOKIE</span>
                <span class='kw'>next</span> <span class='kw'>if</span> <span class='op'>!</span><span class='const'>Options</span><span class='period'>.</span><span class='id instance'>instance</span><span class='period'>.</span><span class='id audit_cookies'>audit_cookies</span>
                <span class='ivar'>@page</span><span class='period'>.</span><span class='id cookies'>cookies</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
                    <span class='op'>|</span><span class='id elem'>elem</span><span class='op'>|</span>
                    <span class='id audit_rdiff_elem'>audit_rdiff_elem</span><span class='lparen'>(</span> <span class='id elem'>elem</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>
                <span class='rbrace'>}</span>

            <span class='kw'>when</span>  <span class='const'>Element</span><span class='op'>::</span><span class='const'>HEADER</span>
                <span class='kw'>next</span> <span class='kw'>if</span> <span class='op'>!</span><span class='const'>Options</span><span class='period'>.</span><span class='id instance'>instance</span><span class='period'>.</span><span class='id audit_headers'>audit_headers</span>
                <span class='ivar'>@page</span><span class='period'>.</span><span class='id headers'>headers</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
                    <span class='op'>|</span><span class='id elem'>elem</span><span class='op'>|</span>
                    <span class='id audit_rdiff_elem'>audit_rdiff_elem</span><span class='lparen'>(</span> <span class='id elem'>elem</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>
                <span class='rbrace'>}</span>
            <span class='kw'>else</span>
                <span class='id raise'>raise</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Unknown element to audit:  </span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id elem'>elem</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='rparen'>)</span>

        <span class='kw'>end</span>

    <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="audit_rdiff_elem-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>audit_rdiff_elem</strong>(elem, opts = {}, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Audits a single element using an rdiff attack.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../Element/Auditable.html" title="Arachni::Element::Auditable (class)">Arachni::Element::Auditable</a></span></tt>)</span>
      
      
        <span class='name'>elem</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the element to audit
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>opts</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
same as for <span class='object_link'><a href="#audit_rdiff-instance_method" title="Arachni::Module::Auditor#audit_rdiff (method)">#audit_rdiff</a></span>
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Block</tt>)</span>
      
      
        <span class='name'>&amp;block</span>
      
      
      
        &mdash;
        <div class='inline'><p>
same as for <span class='object_link'><a href="#audit_rdiff-instance_method" title="Arachni::Module::Auditor#audit_rdiff (method)">#audit_rdiff</a></span>
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734
735
736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 686</span>

<span class='kw'>def</span> <span class='id audit_rdiff_elem'>audit_rdiff_elem</span><span class='lparen'>(</span> <span class='id elem'>elem</span><span class='comma'>,</span> <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>

    <span class='comment'># don't continue if there's a missing value
</span>    <span class='id elem'>elem</span><span class='period'>.</span><span class='id auditable'>auditable</span><span class='period'>.</span><span class='id values'>values</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id val'>val</span><span class='op'>|</span>
        <span class='kw'>return</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id val'>val</span> <span class='op'>||</span> <span class='id val'>val</span><span class='period'>.</span><span class='id empty?'>empty?</span>
    <span class='rbrace'>}</span>

    <span class='kw'>return</span> <span class='kw'>if</span> <span class='id __rdiff_audited?'>__rdiff_audited?</span><span class='lparen'>(</span> <span class='id elem'>elem</span> <span class='rparen'>)</span>
    <span class='id __rdiff_audited!'>__rdiff_audited!</span><span class='lparen'>(</span> <span class='id elem'>elem</span> <span class='rparen'>)</span>

    <span class='id responses'>responses</span> <span class='op'>=</span> <span class='lbrace'>{</span>
        <span class='symbol'>:orig</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span>
        <span class='symbol'>:good</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span>
        <span class='symbol'>:bad</span>  <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span>
        <span class='symbol'>:bad_total</span>  <span class='op'>=&gt;</span> <span class='int'>0</span><span class='comma'>,</span>
        <span class='symbol'>:good_total</span> <span class='op'>=&gt;</span> <span class='int'>0</span>
    <span class='rbrace'>}</span>

    <span class='id elem'>elem</span><span class='period'>.</span><span class='id auditor'>auditor</span><span class='lparen'>(</span> <span class='kw'>self</span> <span class='rparen'>)</span>
    <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:precision</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id times'>times</span> <span class='lbrace'>{</span>
        <span class='comment'># get the default responses
</span>        <span class='id elem'>elem</span><span class='period'>.</span><span class='id audit'>audit</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id opts'>opts</span> <span class='rparen'>)</span> <span class='lbrace'>{</span>
            <span class='op'>|</span><span class='id res'>res</span><span class='op'>|</span>
            <span class='id responses'>responses</span><span class='lbracket'>[</span><span class='symbol'>:orig</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id res'>res</span><span class='period'>.</span><span class='id body'>body</span>
            <span class='comment'># remove context-irrelevant dynamic content like banners and such
</span>            <span class='comment'># from the error page
</span>            <span class='id responses'>responses</span><span class='lbracket'>[</span><span class='symbol'>:orig</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id responses'>responses</span><span class='lbracket'>[</span><span class='symbol'>:orig</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id rdiff'>rdiff</span><span class='lparen'>(</span> <span class='id res'>res</span><span class='period'>.</span><span class='id body'>body</span> <span class='rparen'>)</span>
        <span class='rbrace'>}</span>
    <span class='rbrace'>}</span>

    <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:precision</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id times'>times</span> <span class='lbrace'>{</span>
        <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:faults</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
            <span class='op'>|</span><span class='id str'>str</span><span class='op'>|</span>

            <span class='comment'># get injection variations that will hopefully cause an internal/silent
</span>            <span class='comment'># SQL error
</span>            <span class='id variations'>variations</span> <span class='op'>=</span> <span class='id elem'>elem</span><span class='period'>.</span><span class='id injection_sets'>injection_sets</span><span class='lparen'>(</span> <span class='id str'>str</span><span class='comma'>,</span> <span class='id opts'>opts</span> <span class='rparen'>)</span>

            <span class='id responses'>responses</span><span class='lbracket'>[</span><span class='symbol'>:bad_total</span><span class='rbracket'>]</span> <span class='op'>=</span>  <span class='id variations'>variations</span><span class='period'>.</span><span class='id size'>size</span>

            <span class='id variations'>variations</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
                <span class='op'>|</span><span class='id c_elem'>c_elem</span><span class='op'>|</span>

                <span class='id print_status'>print_status</span><span class='lparen'>(</span> <span class='id c_elem'>c_elem</span><span class='period'>.</span><span class='id get_status_str'>get_status_str</span><span class='lparen'>(</span> <span class='id c_elem'>c_elem</span><span class='period'>.</span><span class='id altered'>altered</span> <span class='rparen'>)</span> <span class='rparen'>)</span>

                <span class='comment'># register us as the auditor
</span>                <span class='id c_elem'>c_elem</span><span class='period'>.</span><span class='id auditor'>auditor</span><span class='lparen'>(</span> <span class='kw'>self</span> <span class='rparen'>)</span>
                <span class='comment'># submit the link and get the response
</span>                <span class='id c_elem'>c_elem</span><span class='period'>.</span><span class='id submit'>submit</span><span class='lparen'>(</span> <span class='id opts'>opts</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id on_complete'>on_complete</span> <span class='lbrace'>{</span>
                    <span class='op'>|</span><span class='id res'>res</span><span class='op'>|</span>

                    <span class='id responses'>responses</span><span class='lbracket'>[</span><span class='symbol'>:bad</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id c_elem'>c_elem</span><span class='period'>.</span><span class='id altered'>altered</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id res'>res</span><span class='period'>.</span><span class='id body'>body</span><span class='period'>.</span><span class='id clone'>clone</span>

                    <span class='comment'># remove context-irrelevant dynamic content like banners and such
</span>                    <span class='comment'># from the error page
</span>                    <span class='id responses'>responses</span><span class='lbracket'>[</span><span class='symbol'>:bad</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id c_elem'>c_elem</span><span class='period'>.</span><span class='id altered'>altered</span><span class='rbracket'>]</span> <span class='op'>=</span>
                        <span class='id responses'>responses</span><span class='lbracket'>[</span><span class='symbol'>:bad</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id c_elem'>c_elem</span><span class='period'>.</span><span class='id altered'>altered</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id rdiff'>rdiff</span><span class='lparen'>(</span> <span class='id res'>res</span><span class='period'>.</span><span class='id body'>body</span><span class='period'>.</span><span class='id clone'>clone</span> <span class='rparen'>)</span>
                <span class='rbrace'>}</span>
            <span class='rbrace'>}</span>
        <span class='rbrace'>}</span>
    <span class='rbrace'>}</span>

    <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:bools</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id str'>str</span><span class='op'>|</span>

        <span class='comment'># get injection variations that will not affect the outcome of the query
</span>        <span class='id variations'>variations</span> <span class='op'>=</span> <span class='id elem'>elem</span><span class='period'>.</span><span class='id injection_sets'>injection_sets</span><span class='lparen'>(</span> <span class='id str'>str</span><span class='comma'>,</span> <span class='id opts'>opts</span> <span class='rparen'>)</span>

        <span class='id responses'>responses</span><span class='lbracket'>[</span><span class='symbol'>:good_total</span><span class='rbracket'>]</span> <span class='op'>=</span>  <span class='id variations'>variations</span><span class='period'>.</span><span class='id size'>size</span>

        <span class='id variations'>variations</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
            <span class='op'>|</span><span class='id c_elem'>c_elem</span><span class='op'>|</span>

            <span class='id print_status'>print_status</span><span class='lparen'>(</span> <span class='id c_elem'>c_elem</span><span class='period'>.</span><span class='id get_status_str'>get_status_str</span><span class='lparen'>(</span> <span class='id c_elem'>c_elem</span><span class='period'>.</span><span class='id altered'>altered</span> <span class='rparen'>)</span> <span class='rparen'>)</span>

            <span class='comment'># register us as the auditor
</span>            <span class='id c_elem'>c_elem</span><span class='period'>.</span><span class='id auditor'>auditor</span><span class='lparen'>(</span> <span class='kw'>self</span> <span class='rparen'>)</span>
            <span class='comment'># submit the link and get the response
</span>            <span class='id c_elem'>c_elem</span><span class='period'>.</span><span class='id submit'>submit</span><span class='lparen'>(</span> <span class='id opts'>opts</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id on_complete'>on_complete</span> <span class='lbrace'>{</span>
                <span class='op'>|</span><span class='id res'>res</span><span class='op'>|</span>

                <span class='id responses'>responses</span><span class='lbracket'>[</span><span class='symbol'>:good</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id c_elem'>c_elem</span><span class='period'>.</span><span class='id altered'>altered</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

                <span class='comment'># save the response for later analysis
</span>                <span class='id responses'>responses</span><span class='lbracket'>[</span><span class='symbol'>:good</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id c_elem'>c_elem</span><span class='period'>.</span><span class='id altered'>altered</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='lbrace'>{</span>
                    <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>str</span><span class='tstring_end'>'</span></span>  <span class='op'>=&gt;</span> <span class='id str'>str</span><span class='comma'>,</span>
                    <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>res</span><span class='tstring_end'>'</span></span>  <span class='op'>=&gt;</span> <span class='id res'>res</span><span class='comma'>,</span>
                    <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>elem</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id c_elem'>c_elem</span>
                <span class='rbrace'>}</span>
            <span class='rbrace'>}</span>
        <span class='rbrace'>}</span>
    <span class='rbrace'>}</span>

    <span class='comment'># when this runs the 'responses' hash will have been populated
</span>    <span class='ivar'>@http</span><span class='period'>.</span><span class='id after_run'>after_run</span> <span class='lbrace'>{</span>

        <span class='id responses'>responses</span><span class='lbracket'>[</span><span class='symbol'>:good</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id keys'>keys</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
            <span class='op'>|</span><span class='id key'>key</span><span class='op'>|</span>

            <span class='id responses'>responses</span><span class='lbracket'>[</span><span class='symbol'>:good</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id key'>key</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
                <span class='op'>|</span><span class='id res'>res</span><span class='op'>|</span>

                <span class='kw'>if</span> <span class='id block'>block</span>
                    <span class='id block'>block</span><span class='period'>.</span><span class='id call'>call</span><span class='lparen'>(</span> <span class='id res'>res</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>str</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id res'>res</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>elem</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id responses'>responses</span><span class='lbracket'>[</span><span class='symbol'>:orig</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id res'>res</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>res</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id responses'>responses</span><span class='lbracket'>[</span><span class='symbol'>:bad</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id key'>key</span><span class='rbracket'>]</span> <span class='rparen'>)</span>
                <span class='kw'>elsif</span><span class='lparen'>(</span> <span class='id responses'>responses</span><span class='lbracket'>[</span><span class='symbol'>:orig</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='id res'>res</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>res</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id body'>body</span> <span class='op'>&amp;&amp;</span>
                    <span class='id responses'>responses</span><span class='lbracket'>[</span><span class='symbol'>:bad</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id key'>key</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='id res'>res</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>res</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id body'>body</span> <span class='op'>&amp;&amp;</span>
                    <span class='op'>!</span><span class='ivar'>@http</span><span class='period'>.</span><span class='id custom_404?'>custom_404?</span><span class='lparen'>(</span> <span class='id res'>res</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>res</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id res'>res</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>res</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id code'>code</span> <span class='op'>==</span> <span class='int'>200</span> <span class='rparen'>)</span>

                    <span class='id url'>url</span> <span class='op'>=</span> <span class='id res'>res</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>res</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id effective_url'>effective_url</span>

                    <span class='comment'># since we bypassed the auditor completely we need to create
</span>                    <span class='comment'># our own opts hash and pass it to the Vulnerability class.
</span>                    <span class='comment'>#
</span>                    <span class='comment'># this is only required for Metasploitable vulnerabilities
</span>                    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span>
                        <span class='symbol'>:injected_orig</span> <span class='op'>=&gt;</span> <span class='id res'>res</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>str</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
                        <span class='symbol'>:combo</span>         <span class='op'>=&gt;</span> <span class='id res'>res</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>elem</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id auditable'>auditable</span>
                    <span class='rbrace'>}</span>

                    <span class='id issue'>issue</span> <span class='op'>=</span> <span class='const'>Issue</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span> <span class='lbrace'>{</span>
                            <span class='symbol'>:var</span>          <span class='op'>=&gt;</span> <span class='id key'>key</span><span class='comma'>,</span>
                            <span class='symbol'>:url</span>          <span class='op'>=&gt;</span> <span class='id url'>url</span><span class='comma'>,</span>
                            <span class='symbol'>:method</span>       <span class='op'>=&gt;</span> <span class='id res'>res</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>res</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id request'>request</span><span class='period'>.</span><span class='id method'>method</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='comma'>,</span>
                            <span class='symbol'>:opts</span>         <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='comma'>,</span>
                            <span class='symbol'>:injected</span>     <span class='op'>=&gt;</span> <span class='id res'>res</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>str</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
                            <span class='symbol'>:id</span>           <span class='op'>=&gt;</span> <span class='id res'>res</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>str</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
                            <span class='symbol'>:regexp</span>       <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>n/a</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
                            <span class='symbol'>:regexp_match</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>n/a</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
                            <span class='symbol'>:elem</span>         <span class='op'>=&gt;</span> <span class='id res'>res</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>elem</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id type'>type</span><span class='comma'>,</span>
                            <span class='symbol'>:response</span>     <span class='op'>=&gt;</span> <span class='id res'>res</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>res</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id body'>body</span><span class='comma'>,</span>
                            <span class='symbol'>:verification</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
                            <span class='symbol'>:headers</span>      <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
                                <span class='symbol'>:request</span>    <span class='op'>=&gt;</span> <span class='id res'>res</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>res</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id request'>request</span><span class='period'>.</span><span class='id headers'>headers</span><span class='comma'>,</span>
                                <span class='symbol'>:response</span>   <span class='op'>=&gt;</span> <span class='id res'>res</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>res</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id headers'>headers</span><span class='comma'>,</span>
                            <span class='rbrace'>}</span>
                        <span class='rbrace'>}</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span> <span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='period'>.</span><span class='id info'>info</span> <span class='rparen'>)</span>
                    <span class='rparen'>)</span>

                    <span class='id print_ok'>print_ok</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>In </span><span class='embexpr_beg'>#{</span><span class='id res'>res</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>elem</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id type'>type</span><span class='rbrace'>}</span><span class='tstring_content'> var '</span><span class='embexpr_beg'>#{</span><span class='id key'>key</span><span class='rbrace'>}</span><span class='tstring_content'>' ( </span><span class='embexpr_beg'>#{</span><span class='id url'>url</span><span class='rbrace'>}</span><span class='tstring_content'> )</span><span class='tstring_end'>&quot;</span></span> <span class='rparen'>)</span>

                    <span class='comment'># register our results with the system
</span>                    <span class='id register_results'>register_results</span><span class='lparen'>(</span> <span class='lbracket'>[</span> <span class='id issue'>issue</span> <span class='rbracket'>]</span> <span class='rparen'>)</span>
                <span class='kw'>end</span>

            <span class='rbrace'>}</span>
        <span class='rbrace'>}</span>
    <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="audit_timeout-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>audit_timeout</strong>(strings, opts) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Audits elements using timing attacks and automatically logs results.
</p>
<p>
Here&#8217;s how it works:
</p>
<ul>
<li><p>
Loop 1 &#8212; Populates the candidate queue. We&#8217;re picking the low
hanging fruit here so we can run this in larger concurrent bursts which
cause <b>lots</b> of noise.
</p>
<ul>
<li><p>
Initial probing for candidates &#8212; Any element that times out is added
to a queue.
</p>
</li>
</ul>
<ul>
<li><p>
Stabilization &#8212; The candidate is submited with its default values in
order to wait until the effects of the timing attack have worn off.
</p>
</li>
</ul>
</li>
<li><p>
Loop 2 &#8212; Verifies the candidates. This is much more delicate so the
concurrent requests are lowered to pairs.
</p>
<ul>
<li><p>
Liveness test &#8212; Ensures that stabilization was successful before
moving on.
</p>
</li>
</ul>
<ul>
<li><p>
Verification using an increased timeout &#8212; Any elements that time out
again are logged.
</p>
</li>
</ul>
<ul>
<li><p>
Stabilization
</p>
</li>
</ul>
</li>
</ul>
<p>
Ideally, all requests involved with timing attacks would be run in sync
mode but the performance penalties are too high, thus we compromise and
make the best of it by running as little an amount of concurrent requests
as possible for any given phase.
</p>
<pre class="code">
   <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span>
       <span class='symbol'>:format</span>  <span class='op'>=&gt;</span> <span class='lbracket'>[</span> <span class='const'>Format</span><span class='op'>::</span><span class='const'>STRAIGHT</span> <span class='rbracket'>]</span><span class='comma'>,</span>
       <span class='symbol'>:timeout</span> <span class='op'>=&gt;</span> <span class='int'>4000</span><span class='comma'>,</span>
       <span class='symbol'>:timeout_divider</span> <span class='op'>=&gt;</span> <span class='int'>1000</span>
   <span class='rbrace'>}</span>

   <span class='id audit_timeout'>audit_timeout</span><span class='lparen'>(</span> <span class='lbracket'>[</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>sleep( __TIME__ );</span><span class='tstring_end'>'</span></span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='id opts'>opts</span> <span class='rparen'>)</span></pre>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
        <span class='name'>strings</span>
      
      
      
        &mdash;
        <div class='inline'><p>
injection strings <em>TIME</em> will be substituded with (timeout /
timeout_divider)
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>opts</span>
      
      
      
        &mdash;
        <div class='inline'><p>
options as described in <span class='object_link'><a href="#OPTIONS-constant" title="Arachni::Module::Auditor::OPTIONS (constant)">OPTIONS</a></span> with the following extra:
</p>
<ul>
<li><p>
:timeout &#8212; milliseconds to wait for the request to complete
</p>
</li>
<li><p>
:timeout_divider &#8212; <em>TIME</em> = timeout / timeout_divider
</p>
</li>
</ul>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 395</span>

<span class='kw'>def</span> <span class='id audit_timeout'>audit_timeout</span><span class='lparen'>(</span> <span class='id strings'>strings</span><span class='comma'>,</span> <span class='id opts'>opts</span> <span class='rparen'>)</span>
    <span class='cvar'>@@__timeout_loaded_modules</span> <span class='op'>&lt;&lt;</span> <span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='period'>.</span><span class='id info'>info</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span>

    <span class='cvar'>@@__timeout_audit_blocks</span> <span class='op'>&lt;&lt;</span> <span class='const'>Proc</span><span class='period'>.</span><span class='id new'>new</span> <span class='lbrace'>{</span>
        <span class='id delay'>delay</span> <span class='op'>=</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:timeout</span><span class='rbracket'>]</span>

        <span class='id audit_timeout_debug_msg'>audit_timeout_debug_msg</span><span class='lparen'>(</span> <span class='int'>1</span><span class='comma'>,</span> <span class='id delay'>delay</span> <span class='rparen'>)</span>
        <span class='id timing_attack'>timing_attack</span><span class='lparen'>(</span> <span class='id strings'>strings</span><span class='comma'>,</span> <span class='id opts'>opts</span> <span class='rparen'>)</span> <span class='lbrace'>{</span>
            <span class='op'>|</span><span class='id res'>res</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='id elem'>elem</span><span class='op'>|</span>

            <span class='comment'># maybe this should be removed to take care of accidental timeouts
</span>            <span class='comment'># and let phase 2 clean up the mess
</span>            <span class='comment'># if !@@__timeout_audited.include?( __rdiff_audit_id( elem ) )
</span>
                <span class='id elem'>elem</span><span class='period'>.</span><span class='id auditor'>auditor</span><span class='lparen'>(</span> <span class='kw'>self</span> <span class='rparen'>)</span>
                <span class='comment'># @@__timeout_audited &lt;&lt; __rdiff_audit_id( elem )
</span>
                <span class='id print_info'>print_info</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Found a candidate -- </span><span class='embexpr_beg'>#{</span><span class='id elem'>elem</span><span class='period'>.</span><span class='id type'>type</span><span class='period'>.</span><span class='id capitalize'>capitalize</span><span class='rbrace'>}</span><span class='tstring_content'> input '</span><span class='embexpr_beg'>#{</span><span class='id elem'>elem</span><span class='period'>.</span><span class='id altered'>altered</span><span class='rbrace'>}</span><span class='tstring_content'>' at </span><span class='embexpr_beg'>#{</span><span class='id elem'>elem</span><span class='period'>.</span><span class='id action'>action</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rparen'>)</span>

                <span class='const'>Arachni</span><span class='op'>::</span><span class='const'>Module</span><span class='op'>::</span><span class='const'>Auditor</span><span class='period'>.</span><span class='id audit_timeout_stabilize'>audit_timeout_stabilize</span><span class='lparen'>(</span> <span class='id elem'>elem</span> <span class='rparen'>)</span>

                <span class='cvar'>@@__timeout_candidates</span> <span class='op'>&lt;&lt;</span> <span class='id elem'>elem</span>
            <span class='comment'># end
</span>        <span class='rbrace'>}</span>
    <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="audit_timeout_debug_msg-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>audit_timeout_debug_msg</strong>(phase, delay) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


543
544
545
546
547
548</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 543</span>

<span class='kw'>def</span> <span class='id audit_timeout_debug_msg'>audit_timeout_debug_msg</span><span class='lparen'>(</span> <span class='id phase'>phase</span><span class='comma'>,</span> <span class='id delay'>delay</span> <span class='rparen'>)</span>
    <span class='id print_debug'>print_debug</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>---------------------------------------------</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span>
    <span class='id print_debug'>print_debug</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Running phase </span><span class='embexpr_beg'>#{</span><span class='id phase'>phase</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_content'> of timing attack.</span><span class='tstring_end'>&quot;</span></span> <span class='rparen'>)</span>
    <span class='id print_debug'>print_debug</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Delay set to: </span><span class='embexpr_beg'>#{</span><span class='id delay'>delay</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_content'> milliseconds</span><span class='tstring_end'>&quot;</span></span> <span class='rparen'>)</span>
    <span class='id print_debug'>print_debug</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>---------------------------------------------</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="log-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>log</strong>(opts, res = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Populates and logs an <span class='object_link'><a href="../Issue.html" title="Arachni::Issue (class)">Issue</a></span> based on data from
&#8220;opts&#8221; and &#8220;res&#8221;.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>opts</span>
      
      
      
        &mdash;
        <div class='inline'><p>
as passed to blocks by audit methods
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Typhoeus/Response.html" title="Typhoeus::Response (class)">Typhoeus::Response</a></span></tt>)</span>
      
      
        <span class='name'>res</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
defaults to @page data
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 220</span>

<span class='kw'>def</span> <span class='id log'>log</span><span class='lparen'>(</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='id res'>res</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='rparen'>)</span>

    <span class='id method'>method</span> <span class='op'>=</span> <span class='kw'>nil</span>

    <span class='id request_headers'>request_headers</span>  <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id response_headers'>response_headers</span> <span class='op'>=</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id response_headers'>response_headers</span>
    <span class='id response'>response</span>         <span class='op'>=</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id html'>html</span>
    <span class='id url'>url</span>              <span class='op'>=</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id url'>url</span>
    <span class='id method'>method</span>           <span class='op'>=</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id method'>method</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='period'>.</span><span class='id upcase'>upcase</span> <span class='kw'>if</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id method'>method</span>

    <span class='kw'>if</span><span class='lparen'>(</span> <span class='id res'>res</span> <span class='rparen'>)</span>
        <span class='id request_headers'>request_headers</span>  <span class='op'>=</span> <span class='id res'>res</span><span class='period'>.</span><span class='id request'>request</span><span class='period'>.</span><span class='id headers'>headers</span>
        <span class='id response_headers'>response_headers</span> <span class='op'>=</span> <span class='id res'>res</span><span class='period'>.</span><span class='id headers'>headers</span>
        <span class='id response'>response</span>         <span class='op'>=</span> <span class='id res'>res</span><span class='period'>.</span><span class='id body'>body</span>
        <span class='id url'>url</span>              <span class='op'>=</span> <span class='id res'>res</span><span class='period'>.</span><span class='id effective_url'>effective_url</span>
        <span class='id method'>method</span>           <span class='op'>=</span> <span class='id res'>res</span><span class='period'>.</span><span class='id request'>request</span><span class='period'>.</span><span class='id method'>method</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='period'>.</span><span class='id upcase'>upcase</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id response_headers'>response_headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>content-type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span>
       <span class='op'>!</span><span class='id response_headers'>response_headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>content-type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id substring?'>substring?</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>text</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span>
        <span class='id response'>response</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>

    <span class='kw'>begin</span>
        <span class='id print_ok'>print_ok</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>In </span><span class='embexpr_beg'>#{</span><span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:element</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'> var '</span><span class='embexpr_beg'>#{</span><span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:altered</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>' ( </span><span class='embexpr_beg'>#{</span><span class='id url'>url</span><span class='rbrace'>}</span><span class='tstring_content'> )</span><span class='tstring_end'>&quot;</span></span> <span class='rparen'>)</span>
    <span class='kw'>rescue</span>
    <span class='kw'>end</span>

    <span class='id print_verbose'>print_verbose</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Injected string:\t</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:injected</span><span class='rbracket'>]</span> <span class='rparen'>)</span> <span class='kw'>if</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:injected</span><span class='rbracket'>]</span>
    <span class='id print_verbose'>print_verbose</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Verified string:\t</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:match</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='rparen'>)</span> <span class='kw'>if</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:match</span><span class='rbracket'>]</span>
    <span class='id print_verbose'>print_verbose</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Matched regular expression: </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:regexp</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='rparen'>)</span>
    <span class='id print_debug'>print_debug</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Request ID: </span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id res'>res</span><span class='period'>.</span><span class='id request'>request</span><span class='period'>.</span><span class='id id'>id</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='rparen'>)</span> <span class='kw'>if</span> <span class='id res'>res</span>
    <span class='id print_verbose'>print_verbose</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>---------</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span> <span class='kw'>if</span> <span class='id only_positives?'>only_positives?</span>

    <span class='comment'># Instantiate a new Vulnerability class and
</span>    <span class='comment'># append it to the results array
</span>    <span class='id vuln'>vuln</span> <span class='op'>=</span> <span class='const'>Issue</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span> <span class='lbrace'>{</span>
        <span class='symbol'>:var</span>          <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:altered</span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='symbol'>:url</span>          <span class='op'>=&gt;</span> <span class='id url'>url</span><span class='comma'>,</span>
        <span class='symbol'>:injected</span>     <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:injected</span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='symbol'>:id</span>           <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='symbol'>:regexp</span>       <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:regexp</span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='symbol'>:regexp_match</span> <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:match</span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='symbol'>:elem</span>         <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:element</span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='symbol'>:verification</span> <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:verification</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='kw'>false</span><span class='comma'>,</span>
        <span class='symbol'>:method</span>       <span class='op'>=&gt;</span> <span class='id method'>method</span><span class='comma'>,</span>
        <span class='symbol'>:response</span>     <span class='op'>=&gt;</span> <span class='id response'>response</span><span class='comma'>,</span>
        <span class='symbol'>:opts</span>         <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='comma'>,</span>
        <span class='symbol'>:headers</span>      <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
            <span class='symbol'>:request</span>    <span class='op'>=&gt;</span> <span class='id request_headers'>request_headers</span><span class='comma'>,</span>
            <span class='symbol'>:response</span>   <span class='op'>=&gt;</span> <span class='id response_headers'>response_headers</span><span class='comma'>,</span>
        <span class='rbrace'>}</span>
    <span class='rbrace'>}</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span> <span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='period'>.</span><span class='id info'>info</span> <span class='rparen'>)</span> <span class='rparen'>)</span>
    <span class='id register_results'>register_results</span><span class='lparen'>(</span> <span class='lbracket'>[</span><span class='id vuln'>vuln</span><span class='rbracket'>]</span> <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="match_and_log-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>match_and_log</strong>(regexps, string = @page.html, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Matches the &#8220;string&#8221; (default string is the HTML code in
@page.html) to an array of regular expressions and logs the results.
</p>
<p>
For good measure, regexps will also be run against the page headers
(@page.response_headers).
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Array&lt;Regexp&gt;</tt>)</span>
      
      
        <span class='name'>regexps</span>
      
      
      
        &mdash;
        <div class='inline'><p>
array of regular expressions to be tested
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
        <span class='name'>string</span>
      
      
        <em class="default">(defaults to: <tt>@page.html</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
string to
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Block</tt>)</span>
      
      
        <span class='name'>block</span>
      
      
      
        &mdash;
        <div class='inline'><p>
block to verify matches before logging, must return true/false
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 166</span>

<span class='kw'>def</span> <span class='id match_and_log'>match_and_log</span><span class='lparen'>(</span> <span class='id regexps'>regexps</span><span class='comma'>,</span> <span class='id string'>string</span> <span class='op'>=</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id html'>html</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>

    <span class='comment'># make sure that we're working with an array
</span>    <span class='id regexps'>regexps</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id regexps'>regexps</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id flatten'>flatten</span>

    <span class='id elems'>elems</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='period'>.</span><span class='id info'>info</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span>
    <span class='id elems'>elems</span> <span class='op'>=</span> <span class='const'>OPTIONS</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id elems'>elems</span> <span class='op'>||</span> <span class='id elems'>elems</span><span class='period'>.</span><span class='id empty?'>empty?</span>

    <span class='id regexps'>regexps</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id regexp'>regexp</span><span class='op'>|</span>

        <span class='id string'>string</span><span class='period'>.</span><span class='id scan'>scan</span><span class='lparen'>(</span> <span class='id regexp'>regexp</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id flatten'>flatten</span><span class='period'>.</span><span class='id uniq'>uniq</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
            <span class='op'>|</span><span class='id match'>match</span><span class='op'>|</span>

            <span class='kw'>next</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id match'>match</span>
            <span class='kw'>next</span> <span class='kw'>if</span> <span class='id block'>block</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id block'>block</span><span class='period'>.</span><span class='id call'>call</span><span class='lparen'>(</span> <span class='id match'>match</span> <span class='rparen'>)</span>

            <span class='id log'>log</span><span class='lparen'>(</span>
                <span class='symbol'>:regexp</span>  <span class='op'>=&gt;</span> <span class='id regexp'>regexp</span><span class='comma'>,</span>
                <span class='symbol'>:match</span>   <span class='op'>=&gt;</span> <span class='id match'>match</span><span class='comma'>,</span>
                <span class='symbol'>:element</span> <span class='op'>=&gt;</span> <span class='const'>Issue</span><span class='op'>::</span><span class='const'>Element</span><span class='op'>::</span><span class='const'>BODY</span>
            <span class='rparen'>)</span>
        <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id elems'>elems</span><span class='period'>.</span><span class='id include?'>include?</span> <span class='const'>Issue</span><span class='op'>::</span><span class='const'>Element</span><span class='op'>::</span><span class='const'>BODY</span>

        <span class='kw'>next</span> <span class='kw'>if</span> <span class='id string'>string</span> <span class='op'>==</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id html'>html</span>

        <span class='ivar'>@page</span><span class='period'>.</span><span class='id response_headers'>response_headers</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
            <span class='op'>|</span><span class='id k'>k</span><span class='comma'>,</span><span class='id v'>v</span><span class='op'>|</span>
            <span class='kw'>next</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id v'>v</span>

            <span class='id v'>v</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='period'>.</span><span class='id scan'>scan</span><span class='lparen'>(</span> <span class='id regexp'>regexp</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id flatten'>flatten</span><span class='period'>.</span><span class='id uniq'>uniq</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
                <span class='op'>|</span><span class='id match'>match</span><span class='op'>|</span>

                <span class='kw'>next</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id match'>match</span>
                <span class='kw'>next</span> <span class='kw'>if</span> <span class='id block'>block</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id block'>block</span><span class='period'>.</span><span class='id call'>call</span><span class='lparen'>(</span> <span class='id match'>match</span> <span class='rparen'>)</span>

                <span class='id log'>log</span><span class='lparen'>(</span>
                    <span class='symbol'>:var</span> <span class='op'>=&gt;</span> <span class='id k'>k</span><span class='comma'>,</span>
                    <span class='symbol'>:regexp</span>  <span class='op'>=&gt;</span> <span class='id regexp'>regexp</span><span class='comma'>,</span>
                    <span class='symbol'>:match</span>   <span class='op'>=&gt;</span> <span class='id match'>match</span><span class='comma'>,</span>
                    <span class='symbol'>:element</span> <span class='op'>=&gt;</span> <span class='const'>Issue</span><span class='op'>::</span><span class='const'>Element</span><span class='op'>::</span><span class='const'>HEADER</span>
                <span class='rparen'>)</span>
            <span class='rbrace'>}</span>
        <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id elems'>elems</span><span class='period'>.</span><span class='id include?'>include?</span> <span class='const'>Issue</span><span class='op'>::</span><span class='const'>Element</span><span class='op'>::</span><span class='const'>HEADER</span>

    <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="skip?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>skip?</strong>(elem) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
This is called right before an [Arachni::Parser::Element] is
submitted/auditted and is used to determine whether to skip it or not.
</p>
<p>
Running modules can override this as they wish <b>but</b> at their own
peril.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../Parser/Element.html" title="Arachni::Parser::Element (module)">Arachni::Parser::Element</a></span></tt>)</span>
      
      
        <span class='name'>elem</span>
      
      
      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 342</span>

<span class='kw'>def</span> <span class='id skip?'>skip?</span><span class='lparen'>(</span> <span class='id elem'>elem</span> <span class='rparen'>)</span>
    <span class='id redundant'>redundant</span><span class='period'>.</span><span class='id map'>map</span> <span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id mod'>mod</span><span class='op'>|</span>

        <span class='id mod_name'>mod_name</span> <span class='op'>=</span> <span class='ivar'>@framework</span><span class='period'>.</span><span class='id modules'>modules</span><span class='lbracket'>[</span><span class='id mod'>mod</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id info'>info</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span>

        <span class='id set_id'>set_id</span> <span class='op'>=</span> <span class='ivar'>@framework</span><span class='period'>.</span><span class='id modules'>modules</span><span class='period'>.</span><span class='id class'>class</span><span class='period'>.</span><span class='id issue_set_id_from_elem'>issue_set_id_from_elem</span><span class='lparen'>(</span> <span class='id mod_name'>mod_name</span><span class='comma'>,</span> <span class='id elem'>elem</span> <span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='ivar'>@framework</span><span class='period'>.</span><span class='id modules'>modules</span><span class='period'>.</span><span class='id issue_set'>issue_set</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span> <span class='id set_id'>set_id</span> <span class='rparen'>)</span>
    <span class='rbrace'>}</span>


    <span class='comment'># if !@@__timeout_audited.empty?
</span>        <span class='comment'># return @@__timeout_audited.include?( __rdiff_audit_id( elem ) )
</span>    <span class='comment'># end
</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="timing_attack-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>timing_attack</strong>(strings, opts, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Audits elements using a timing attack.
</p>
<p>
&#8216;opts&#8217; needs to contain a :timeout value in milliseconds.</br>
Optionally, you can add a :timeout_divider.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
        <span class='name'>strings</span>
      
      
      
        &mdash;
        <div class='inline'><p>
injection strings &#8216;<em>TIME</em>&#8217; will be substituded with
(timeout / timeout_divider)
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>opts</span>
      
      
      
        &mdash;
        <div class='inline'><p>
options as described in <span class='object_link'><a href="#OPTIONS-constant" title="Arachni::Module::Auditor::OPTIONS (constant)">OPTIONS</a></span>
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Block</tt>)</span>
      
      
        <span class='name'>&amp;block</span>
      
      
      
        &mdash;
        <div class='inline'><p>
block to call if a timeout occurs, it will be passed the response and opts
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 562</span>

<span class='kw'>def</span> <span class='id timing_attack'>timing_attack</span><span class='lparen'>(</span> <span class='id strings'>strings</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>

    <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:timeout_divider</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='int'>1</span>
    <span class='comment'># opts[:async] = false
</span>
    <span class='lbracket'>[</span><span class='id strings'>strings</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id flatten'>flatten</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id str'>str</span><span class='op'>|</span>

        <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:timing_string</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id str'>str</span>
        <span class='id str'>str</span> <span class='op'>=</span> <span class='id str'>str</span><span class='period'>.</span><span class='id gsub'>gsub</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>__TIME__</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='lparen'>(</span> <span class='lparen'>(</span><span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:timeout</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='int'>3</span> <span class='op'>*</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:timeout_divider</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:timeout_divider</span><span class='rbracket'>]</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='rparen'>)</span>
        <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:skip_orig</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span>

        <span class='id audit'>audit</span><span class='lparen'>(</span> <span class='id str'>str</span><span class='comma'>,</span> <span class='id opts'>opts</span> <span class='rparen'>)</span> <span class='lbrace'>{</span>
            <span class='op'>|</span><span class='id res'>res</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='id elem'>elem</span><span class='op'>|</span>
            <span class='id block'>block</span><span class='period'>.</span><span class='id call'>call</span><span class='lparen'>(</span> <span class='id res'>res</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='id elem'>elem</span> <span class='rparen'>)</span> <span class='kw'>if</span> <span class='id block'>block</span> <span class='op'>&amp;&amp;</span> <span class='id res'>res</span><span class='period'>.</span><span class='id timed_out?'>timed_out?</span>
        <span class='rbrace'>}</span>
    <span class='rbrace'>}</span>

    <span class='ivar'>@http</span><span class='period'>.</span><span class='id run'>run</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Tue Jul 26 21:35:15 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.5 (ruby-1.9.2).
</div>

  </body>
</html>