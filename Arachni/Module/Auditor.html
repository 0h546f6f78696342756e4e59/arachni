<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module: Arachni::Module::Auditor</title>
<link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (A)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../Arachni.html" title="Arachni (module)">Arachni</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Module.html" title="Arachni::Module (module)">Module</a></span></span>
     &raquo; 
    <span class="title">Auditor</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Module: Arachni::Module::Auditor
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
    <dt class="r1">Included in:</dt>
    <dd class="r1"><span class='object_link'><a href="Base.html" title="Arachni::Module::Base (class)">Base</a></span></dd>
    
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/module/auditor.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
Auditor module
</p>
<p>
Included by <span class='object_link'><a href="Base.html" title="Arachni::Module::Base (class)">Base</a></span>.<br/> Includes audit methods.
</p>
<p>
@author: Tasos &#8220;Zapotek&#8221; Laskos
</p>
<pre class="code">
                                     &lt;tasos.laskos@gmail.com&gt;
                                     &lt;zapotek@segfault.gr&gt;
</pre>
<p>
@version: 0.2.2
</p>


  </div>
</div>
<div class="tags">
  
</div><h2>Defined Under Namespace</h2>
<p class="children">
   
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Auditor/Element.html" title="Arachni::Module::Auditor::Element (module)">Element</a></span>, <span class='object_link'><a href="Auditor/Format.html" title="Arachni::Module::Auditor::Format (module)">Format</a></span>
    
   
    
  
</p>

  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="OPTIONS-constant" class="">OPTIONS =
          <div class="docstring">
  <div class="discussion">
    <p>
Default audit options.
</p>


  </div>
</div>
<div class="tags">
  
</div>
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span>

    <span class='comment'>#
</span>    <span class='comment'># Elements to audit.
</span>    <span class='comment'>#
</span>    <span class='comment'># Only required when calling {#audit}.&lt;br/&gt;
</span>    <span class='comment'># If no elements have been passed to audit it will
</span>    <span class='comment'># use the elements in {#self.info}.
</span>    <span class='comment'>#
</span>    <span class='symbol'>:elements</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span> <span class='const'>Element</span><span class='op'>::</span><span class='const'>LINK</span><span class='comma'>,</span> <span class='const'>Element</span><span class='op'>::</span><span class='const'>FORM</span><span class='comma'>,</span>
                   <span class='const'>Element</span><span class='op'>::</span><span class='const'>COOKIE</span><span class='comma'>,</span> <span class='const'>Element</span><span class='op'>::</span><span class='const'>HEADER</span><span class='comma'>,</span>
                   <span class='const'>Issue</span><span class='op'>::</span><span class='const'>Element</span><span class='op'>::</span><span class='const'>BODY</span> <span class='rbracket'>]</span><span class='comma'>,</span>

    <span class='comment'>#
</span>    <span class='comment'># The regular expression to match against the response body.
</span>    <span class='comment'>#
</span>    <span class='symbol'>:regexp</span>   <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span>

    <span class='comment'>#
</span>    <span class='comment'># Verify the matched string with this value.
</span>    <span class='comment'>#
</span>    <span class='symbol'>:match</span>    <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span>

    <span class='comment'>#
</span>    <span class='comment'># Formatting of the injection strings.
</span>    <span class='comment'>#
</span>    <span class='comment'># A new set of audit inputs will be generated
</span>    <span class='comment'># for each value in the array.
</span>    <span class='comment'>#
</span>    <span class='comment'># Values can be OR'ed bitfields of all available constants
</span>    <span class='comment'># of {Auditor::Format}.
</span>    <span class='comment'>#
</span>    <span class='comment'># @see  Auditor::Format
</span>    <span class='comment'>#
</span>    <span class='symbol'>:format</span>   <span class='op'>=&gt;</span> <span class='lbracket'>[</span> <span class='const'>Format</span><span class='op'>::</span><span class='const'>STRAIGHT</span><span class='comma'>,</span> <span class='const'>Format</span><span class='op'>::</span><span class='const'>APPEND</span><span class='comma'>,</span>
                   <span class='const'>Format</span><span class='op'>::</span><span class='const'>NULL</span><span class='comma'>,</span> <span class='const'>Format</span><span class='op'>::</span><span class='const'>APPEND</span> <span class='op'>|</span> <span class='const'>Format</span><span class='op'>::</span><span class='const'>NULL</span> <span class='rbracket'>]</span><span class='comma'>,</span>

    <span class='comment'>#
</span>    <span class='comment'># If 'train' is set to true the HTTP response will be
</span>    <span class='comment'># analyzed for new elements. &lt;br/&gt;
</span>    <span class='comment'># Be carefull when enabling it, there'll be a performance penalty.
</span>    <span class='comment'>#
</span>    <span class='comment'># When the Auditor submits a form with original or sample values
</span>    <span class='comment'># this option will be overriden to true.
</span>    <span class='comment'>#
</span>    <span class='symbol'>:train</span>     <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>

    <span class='comment'>#
</span>    <span class='comment'># Enable skipping of already audited inputs
</span>    <span class='comment'>#
</span>    <span class='symbol'>:redundant</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>

    <span class='comment'>#
</span>    <span class='comment'># Make requests asynchronously
</span>    <span class='comment'>#
</span>    <span class='symbol'>:async</span>     <span class='op'>=&gt;</span> <span class='kw'>true</span>
<span class='rbrace'>}</span></pre></dd>
      
    </dl>
  



  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#audit-instance_method" title="#audit (instance method)">- (Object) <strong>audit</strong>(injection_str, opts = { }, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Provides easy access to element auditing.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#audit_elems-instance_method" title="#audit_elems (instance method)">- (Object) <strong>audit_elems</strong>(elements, injection_str, opts = { }, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Audits Auditalble HTML/HTTP elements.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#audit_timeout-instance_method" title="#audit_timeout (instance method)">- (Object) <strong>audit_timeout</strong>(strings, opts) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Audits elements using a 2 phase timing attack and logs results.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#audit_timeout_debug_msg-instance_method" title="#audit_timeout_debug_msg (instance method)">- (Object) <strong>audit_timeout_debug_msg</strong>(phase, delay) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#audit_timeout_phase_2-instance_method" title="#audit_timeout_phase_2 (instance method)">- (Object) <strong>audit_timeout_phase_2</strong>(elem) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Runs phase 2 of the timing attack auditng an individual element (which
passed phase 1) with a higher delay and timeout.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#log-instance_method" title="#log (instance method)">- (Object) <strong>log</strong>(opts, res = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Logs a vulnerability based on a regular expression and it&#8217;s matched
string.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#match_and_log-instance_method" title="#match_and_log (instance method)">- (Object) <strong>match_and_log</strong>(regexps, string = @page.html, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Matches the HTML in @page.html to an array of regular expressions and logs
the results.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#method_missing-instance_method" title="#method_missing (instance method)">- (Object) <strong>method_missing</strong>(sym, *args, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Provides the following methods:
</p>
<ul>
<li><p>
audit_links()
</p>
</li>
<li><p>
audit_forms()
</p>
</li>
<li><p>
audit_cookies()
</p>
</li>
<li><p>
audit_headers().
</p>
</li>
</ul>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#skip%3F-instance_method" title="#skip? (instance method)">- (Boolean) <strong>skip?</strong>(elem) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
ABSTRACT - OPTIONAL.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#timing_attack-instance_method" title="#timing_attack (instance method)">- (Object) <strong>timing_attack</strong>(strings, opts, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Audits elements using a timing attack.
</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="method_missing_details" class="method_details_list">
  <h2>Dynamic Method Handling</h2>
  <p class="notice this">
    This class handles dynamic methods through the <tt>method_missing</tt> method
    
  </p>
  
    <div class="method_details first">
  <p class="signature first" id="method_missing-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>method_missing</strong>(sym, *args, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Provides the following methods:
</p>
<ul>
<li><p>
audit_links()
</p>
</li>
<li><p>
audit_forms()
</p>
</li>
<li><p>
audit_cookies()
</p>
</li>
<li><p>
audit_headers()
</p>
</li>
</ul>
<p>
Metaprogrammed to avoid redundant code while maintaining compatibility and
method shortcuts.
</p>


  </div>
</div>
<div class="tags">
  <h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>NoMethodError</tt>)</span>
      
      
      
      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><span class='object_link'><a href="#audit_elems-instance_method" title="Arachni::Module::Auditor#audit_elems (method)">#audit_elems</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


421
422
423
424
425
426
427
428
429
430
431
432
433
434
435</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 421</span>

<span class='kw'>def</span> <span class='id method_missing'>method_missing</span><span class='lparen'>(</span> <span class='id sym'>sym</span><span class='comma'>,</span> <span class='op'>*</span><span class='id args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>

    <span class='id elem'>elem</span> <span class='op'>=</span> <span class='id sym'>sym</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='period'>.</span><span class='id gsub!'>gsub!</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>audit_</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>@</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span>
    <span class='id raise'>raise</span> <span class='const'>NoMethodError</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Undefined method '</span><span class='embexpr_beg'>#{</span><span class='id sym'>sym</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_content'>'.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id sym'>sym</span><span class='comma'>,</span> <span class='id args'>args</span> <span class='rparen'>)</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id elem'>elem</span>

    <span class='id elems'>elems</span> <span class='op'>=</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id instance_variable_get'>instance_variable_get</span><span class='lparen'>(</span> <span class='id elem'>elem</span> <span class='rparen'>)</span>

    <span class='kw'>if</span><span class='lparen'>(</span> <span class='id elems'>elems</span> <span class='op'>&amp;&amp;</span> <span class='id elem'>elem</span> <span class='rparen'>)</span>
        <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Missing required argument 'injection_str'</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> for audit_</span><span class='embexpr_beg'>#{</span><span class='id elem'>elem</span><span class='period'>.</span><span class='id gsub'>gsub</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>@</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span><span class='rbrace'>}</span><span class='tstring_content'>().</span><span class='tstring_end'>&quot;</span></span> <span class='rparen'>)</span> <span class='kw'>if</span><span class='lparen'>(</span> <span class='op'>!</span><span class='id args'>args</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='rparen'>)</span>
        <span class='id audit_elems'>audit_elems</span><span class='lparen'>(</span> <span class='id elems'>elems</span><span class='comma'>,</span> <span class='id args'>args</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id args'>args</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>?</span> <span class='id args'>args</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='op'>:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>
    <span class='kw'>else</span>
        <span class='id raise'>raise</span> <span class='const'>NoMethodError</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Undefined method '</span><span class='embexpr_beg'>#{</span><span class='id sym'>sym</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_content'>'.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id sym'>sym</span><span class='comma'>,</span> <span class='id args'>args</span> <span class='rparen'>)</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="audit-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>audit</strong>(injection_str, opts = { }, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Provides easy access to element auditing.
</p>
<p>
If no elements have been specified in &#8216;opts&#8217; it will use the
elements from the module&#8217;s &#8220;self.info()&#8221; hash. <br/> If
no elements have been specified in &#8216;opts&#8217; or
&#8220;self.info()&#8221; it will use the elements in <span class='object_link'><a href="#OPTIONS-constant" title="Arachni::Module::Auditor::OPTIONS (constant)">OPTIONS</a></span>. <br/>
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
        <span class='name'>injection_str</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the string to be injected
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>opts</span>
      
      
        <em class="default">(defaults to: <tt>{ }</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
options as described in <span class='object_link'><a href="#OPTIONS-constant" title="Arachni::Module::Auditor::OPTIONS (constant)">OPTIONS</a></span>
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Block</tt>)</span>
      
      
        <span class='name'>&amp;block</span>
      
      
      
        &mdash;
        <div class='inline'><p>
block to be passed the:
</p>
<ul>
<li><p>
HTTP response
</p>
</li>
<li><p>
name of the input vector
</p>
</li>
<li><p>
updated opts
</p>
</li>
</ul>
<pre class="code">
 The block will be called as soon as the
 HTTP response is received.</pre>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 266</span>

<span class='kw'>def</span> <span class='id audit'>audit</span><span class='lparen'>(</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>

    <span class='kw'>if</span><span class='lparen'>(</span> <span class='op'>!</span><span class='id opts'>opts</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span> <span class='symbol'>:elements</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>!</span><span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id empty?'>empty?</span> <span class='rparen'>)</span>
        <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='period'>.</span><span class='id info'>info</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span><span class='lparen'>(</span> <span class='op'>!</span><span class='id opts'>opts</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span> <span class='symbol'>:elements</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>!</span><span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id empty?'>empty?</span> <span class='rparen'>)</span>
        <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>OPTIONS</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='id opts'>opts</span>  <span class='op'>=</span> <span class='const'>OPTIONS</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span> <span class='id opts'>opts</span> <span class='rparen'>)</span>

    <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id elem'>elem</span><span class='op'>|</span>

        <span class='kw'>case</span> <span class='id elem'>elem</span>

            <span class='kw'>when</span>  <span class='const'>Element</span><span class='op'>::</span><span class='const'>LINK</span>
                <span class='id audit_links'>audit_links</span><span class='lparen'>(</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>

            <span class='kw'>when</span>  <span class='const'>Element</span><span class='op'>::</span><span class='const'>FORM</span>
                <span class='id audit_forms'>audit_forms</span><span class='lparen'>(</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>

            <span class='kw'>when</span>  <span class='const'>Element</span><span class='op'>::</span><span class='const'>COOKIE</span>
                <span class='id audit_cookies'>audit_cookies</span><span class='lparen'>(</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>

            <span class='kw'>when</span>  <span class='const'>Element</span><span class='op'>::</span><span class='const'>HEADER</span>
                <span class='id audit_headers'>audit_headers</span><span class='lparen'>(</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>
            <span class='kw'>else</span>
                <span class='id raise'>raise</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Unknown element to audit:  </span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id elem'>elem</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='rparen'>)</span>

        <span class='kw'>end</span>

    <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="audit_elems-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>audit_elems</strong>(elements, injection_str, opts = { }, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Audits Auditalble HTML/HTTP elements
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="../Element/Auditable.html" title="Arachni::Element::Auditable (class)">Arachni::Element::Auditable</a></span>&gt;</tt>)</span>
      
      
        <span class='name'>elements</span>
      
      
      
        &mdash;
        <div class='inline'><p>
auditable elements to audit
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
        <span class='name'>injection_str</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the string to be injected
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>opts</span>
      
      
        <em class="default">(defaults to: <tt>{ }</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
options as described in <span class='object_link'><a href="#OPTIONS-constant" title="Arachni::Module::Auditor::OPTIONS (constant)">OPTIONS</a></span>
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Block</tt>)</span>
      
      
        <span class='name'>&amp;block</span>
      
      
      
        &mdash;
        <div class='inline'><p>
block to be passed the:
</p>
<ul>
<li><p>
HTTP response
</p>
</li>
<li><p>
name of the input vector
</p>
</li>
<li><p>
updated opts
</p>
</li>
</ul>
<pre class="code">
 The block will be called as soon as the
 HTTP response is received.</pre>
</div>
      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><span class='object_link'><a href="#method_missing-instance_method" title="Arachni::Module::Auditor#method_missing (method)">#method_missing</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


452
453
454
455
456
457
458
459
460
461
462
463
464</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 452</span>

<span class='kw'>def</span> <span class='id audit_elems'>audit_elems</span><span class='lparen'>(</span> <span class='id elements'>elements</span><span class='comma'>,</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>

    <span class='id opts'>opts</span>            <span class='op'>=</span> <span class='const'>OPTIONS</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span> <span class='id opts'>opts</span> <span class='rparen'>)</span>
    <span class='id url'>url</span>             <span class='op'>=</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id url'>url</span>

    <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:injected_orig</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id injection_str'>injection_str</span>

    <span class='id elements'>elements</span><span class='period'>.</span><span class='id each'>each</span><span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id elem'>elem</span><span class='op'>|</span>
        <span class='id elem'>elem</span><span class='period'>.</span><span class='id auditor'>auditor</span><span class='lparen'>(</span> <span class='kw'>self</span> <span class='rparen'>)</span>
        <span class='id elem'>elem</span><span class='period'>.</span><span class='id audit'>audit</span><span class='lparen'>(</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>
    <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="audit_timeout-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>audit_timeout</strong>(strings, opts) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Audits elements using a 2 phase timing attack and logs results.
</p>
<p>
&#8216;opts&#8217; needs to contain a :timeout value in milliseconds.</br>
Optionally, you can add a :timeout_divider.
</p>
<p>
Phase 1 uses the timeout value passed in opts, phase 2 uses (timeout * 2).
</br> If phase 1 fails, phase 2 is aborted. </br> If we have a result in
phase 1, phase 2 verifies that result with the higher timeout.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
        <span class='name'>strings</span>
      
      
      
        &mdash;
        <div class='inline'><p>
injection strings &#8216;<em>TIME</em>&#8217; will be substituded with
(timeout / timeout_divider)
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>opts</span>
      
      
      
        &mdash;
        <div class='inline'><p>
options as described in <span class='object_link'><a href="#OPTIONS-constant" title="Arachni::Module::Auditor::OPTIONS (constant)">OPTIONS</a></span>
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


331
332
333
334
335
336
337
338
339
340
341
342
343
344
345</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 331</span>

<span class='kw'>def</span> <span class='id audit_timeout'>audit_timeout</span><span class='lparen'>(</span> <span class='id strings'>strings</span><span class='comma'>,</span> <span class='id opts'>opts</span> <span class='rparen'>)</span>
    <span class='id logged'>logged</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id new'>new</span>

    <span class='id delay'>delay</span> <span class='op'>=</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:timeout</span><span class='rbracket'>]</span>

    <span class='id audit_timeout_debug_msg'>audit_timeout_debug_msg</span><span class='lparen'>(</span> <span class='int'>1</span><span class='comma'>,</span> <span class='id delay'>delay</span> <span class='rparen'>)</span>
    <span class='id timing_attack'>timing_attack</span><span class='lparen'>(</span> <span class='id strings'>strings</span><span class='comma'>,</span> <span class='id opts'>opts</span> <span class='rparen'>)</span> <span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id res'>res</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='id elem'>elem</span><span class='op'>|</span>

        <span class='kw'>if</span> <span class='op'>!</span><span class='id logged'>logged</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:altered</span><span class='rbracket'>]</span> <span class='rparen'>)</span>
            <span class='id logged'>logged</span> <span class='op'>&lt;&lt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:altered</span><span class='rbracket'>]</span>
            <span class='id audit_timeout_phase_2'>audit_timeout_phase_2</span><span class='lparen'>(</span> <span class='id elem'>elem</span> <span class='rparen'>)</span>
        <span class='kw'>end</span>
    <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="audit_timeout_debug_msg-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>audit_timeout_debug_msg</strong>(phase, delay) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


375
376
377
378
379
380</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 375</span>

<span class='kw'>def</span> <span class='id audit_timeout_debug_msg'>audit_timeout_debug_msg</span><span class='lparen'>(</span> <span class='id phase'>phase</span><span class='comma'>,</span> <span class='id delay'>delay</span> <span class='rparen'>)</span>
    <span class='id print_debug'>print_debug</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>---------------------------------------------</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span>
    <span class='id print_debug'>print_debug</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Running phase </span><span class='embexpr_beg'>#{</span><span class='id phase'>phase</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_content'> of timing attack.</span><span class='tstring_end'>&quot;</span></span> <span class='rparen'>)</span>
    <span class='id print_debug'>print_debug</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Delay set to: </span><span class='embexpr_beg'>#{</span><span class='id delay'>delay</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_content'> milliseconds</span><span class='tstring_end'>&quot;</span></span> <span class='rparen'>)</span>
    <span class='id print_debug'>print_debug</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>---------------------------------------------</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="audit_timeout_phase_2-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>audit_timeout_phase_2</strong>(elem) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Runs phase 2 of the timing attack auditng an individual element (which
passed phase 1) with a higher delay and timeout
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 351</span>

<span class='kw'>def</span> <span class='id audit_timeout_phase_2'>audit_timeout_phase_2</span><span class='lparen'>(</span> <span class='id elem'>elem</span> <span class='rparen'>)</span>

    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='id elem'>elem</span><span class='period'>.</span><span class='id opts'>opts</span>
    <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:timeout</span><span class='rbracket'>]</span> <span class='op'>*=</span> <span class='int'>2</span>

    <span class='id audit_timeout_debug_msg'>audit_timeout_debug_msg</span><span class='lparen'>(</span> <span class='int'>2</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:timeout</span><span class='rbracket'>]</span> <span class='rparen'>)</span>

    <span class='id str'>str</span> <span class='op'>=</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:timing_string</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id gsub'>gsub</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>__TIME__</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
        <span class='lparen'>(</span> <span class='lparen'>(</span><span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:timeout</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='int'>3000</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:timeout_divider</span><span class='rbracket'>]</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='rparen'>)</span>

    <span class='id elem'>elem</span><span class='period'>.</span><span class='id auditor'>auditor</span><span class='lparen'>(</span> <span class='kw'>self</span> <span class='rparen'>)</span>
    <span class='id elem'>elem</span><span class='period'>.</span><span class='id audit'>audit</span><span class='lparen'>(</span> <span class='id str'>str</span><span class='comma'>,</span> <span class='id opts'>opts</span> <span class='rparen'>)</span> <span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id res'>res</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='op'>|</span>

        <span class='kw'>if</span> <span class='id res'>res</span><span class='period'>.</span><span class='id timed_out?'>timed_out?</span>

            <span class='comment'># all issues logged by timing attacks need manual verification.
</span>            <span class='comment'># end of story.
</span>            <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:verification</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span>
            <span class='id log'>log</span><span class='lparen'>(</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='id res'>res</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
    <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="log-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>log</strong>(opts, res = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Logs a vulnerability based on a regular expression and it&#8217;s matched
string
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Regexp</tt>)</span>
      
      
        <span class='name'>regexp</span>
      
      
      
    </li>
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
        <span class='name'>match</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 192</span>

<span class='kw'>def</span> <span class='id log'>log</span><span class='lparen'>(</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='id res'>res</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='rparen'>)</span>

    <span class='id method'>method</span> <span class='op'>=</span> <span class='kw'>nil</span>

    <span class='id request_headers'>request_headers</span>  <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id response_headers'>response_headers</span> <span class='op'>=</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id response_headers'>response_headers</span>
    <span class='id response'>response</span>         <span class='op'>=</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id html'>html</span>
    <span class='id url'>url</span>              <span class='op'>=</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id url'>url</span>
    <span class='id method'>method</span>           <span class='op'>=</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id method'>method</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='period'>.</span><span class='id upcase'>upcase</span> <span class='kw'>if</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id method'>method</span>

    <span class='kw'>if</span><span class='lparen'>(</span> <span class='id res'>res</span> <span class='rparen'>)</span>
        <span class='id request_headers'>request_headers</span>  <span class='op'>=</span> <span class='id res'>res</span><span class='period'>.</span><span class='id request'>request</span><span class='period'>.</span><span class='id headers'>headers</span>
        <span class='id response_headers'>response_headers</span> <span class='op'>=</span> <span class='id res'>res</span><span class='period'>.</span><span class='id headers'>headers</span>
        <span class='id response'>response</span>         <span class='op'>=</span> <span class='id res'>res</span><span class='period'>.</span><span class='id body'>body</span>
        <span class='id url'>url</span>              <span class='op'>=</span> <span class='id res'>res</span><span class='period'>.</span><span class='id effective_url'>effective_url</span>
        <span class='id method'>method</span>           <span class='op'>=</span> <span class='id res'>res</span><span class='period'>.</span><span class='id request'>request</span><span class='period'>.</span><span class='id method'>method</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='period'>.</span><span class='id upcase'>upcase</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id response_headers'>response_headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>content-type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span>
       <span class='op'>!</span><span class='id response_headers'>response_headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>content-type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id substring?'>substring?</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>text</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span>
        <span class='id response'>response</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>

    <span class='kw'>begin</span>
        <span class='id print_ok'>print_ok</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>In </span><span class='embexpr_beg'>#{</span><span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:element</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'> var '</span><span class='embexpr_beg'>#{</span><span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:altered</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>' ( </span><span class='embexpr_beg'>#{</span><span class='id url'>url</span><span class='rbrace'>}</span><span class='tstring_content'> )</span><span class='tstring_end'>&quot;</span></span> <span class='rparen'>)</span>
    <span class='kw'>rescue</span>
    <span class='kw'>end</span>

    <span class='id print_verbose'>print_verbose</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Injected string:\t</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:injected</span><span class='rbracket'>]</span> <span class='rparen'>)</span> <span class='kw'>if</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:injected</span><span class='rbracket'>]</span>
    <span class='id print_verbose'>print_verbose</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Verified string:\t</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:match</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='rparen'>)</span> <span class='kw'>if</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:match</span><span class='rbracket'>]</span>
    <span class='id print_verbose'>print_verbose</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Matched regular expression: </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:regexp</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='rparen'>)</span>
    <span class='id print_debug'>print_debug</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Request ID: </span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id res'>res</span><span class='period'>.</span><span class='id request'>request</span><span class='period'>.</span><span class='id id'>id</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='rparen'>)</span> <span class='kw'>if</span> <span class='id res'>res</span>
    <span class='id print_verbose'>print_verbose</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>---------</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span> <span class='kw'>if</span> <span class='id only_positives?'>only_positives?</span>

    <span class='comment'># Instantiate a new Vulnerability class and
</span>    <span class='comment'># append it to the results array
</span>    <span class='id vuln'>vuln</span> <span class='op'>=</span> <span class='const'>Issue</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span> <span class='lbrace'>{</span>
        <span class='symbol'>:var</span>          <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:altered</span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='symbol'>:url</span>          <span class='op'>=&gt;</span> <span class='id url'>url</span><span class='comma'>,</span>
        <span class='symbol'>:injected</span>     <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:injected</span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='symbol'>:id</span>           <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='symbol'>:regexp</span>       <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:regexp</span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='symbol'>:regexp_match</span> <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:match</span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='symbol'>:elem</span>         <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:element</span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='symbol'>:verification</span> <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:verification</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='kw'>false</span><span class='comma'>,</span>
        <span class='symbol'>:method</span>       <span class='op'>=&gt;</span> <span class='id method'>method</span><span class='comma'>,</span>
        <span class='symbol'>:response</span>     <span class='op'>=&gt;</span> <span class='id response'>response</span><span class='comma'>,</span>
        <span class='symbol'>:opts</span>         <span class='op'>=&gt;</span> <span class='id opts'>opts</span><span class='comma'>,</span>
        <span class='symbol'>:headers</span>      <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
            <span class='symbol'>:request</span>    <span class='op'>=&gt;</span> <span class='id request_headers'>request_headers</span><span class='comma'>,</span>
            <span class='symbol'>:response</span>   <span class='op'>=&gt;</span> <span class='id response_headers'>response_headers</span><span class='comma'>,</span>
        <span class='rbrace'>}</span>
    <span class='rbrace'>}</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span> <span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='period'>.</span><span class='id info'>info</span> <span class='rparen'>)</span> <span class='rparen'>)</span>
    <span class='id register_results'>register_results</span><span class='lparen'>(</span> <span class='lbracket'>[</span><span class='id vuln'>vuln</span><span class='rbracket'>]</span> <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="match_and_log-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>match_and_log</strong>(regexps, string = @page.html, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Matches the HTML in @page.html to an array of regular expressions and logs
the results.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Array&lt;Regexp&gt;</tt>)</span>
      
      
        <span class='name'>regexps</span>
      
      
      
    </li>
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
        <span class='name'>string</span>
      
      
        <em class="default">(defaults to: <tt>@page.html</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Block</tt>)</span>
      
      
        <span class='name'>block</span>
      
      
      
        &mdash;
        <div class='inline'><p>
block to verify matches before logging must return true/false
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 138</span>

<span class='kw'>def</span> <span class='id match_and_log'>match_and_log</span><span class='lparen'>(</span> <span class='id regexps'>regexps</span><span class='comma'>,</span> <span class='id string'>string</span> <span class='op'>=</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id html'>html</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>

    <span class='comment'># make sure that we're working with an array
</span>    <span class='id regexps'>regexps</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id regexps'>regexps</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id flatten'>flatten</span>

    <span class='id elems'>elems</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='period'>.</span><span class='id info'>info</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span>
    <span class='id elems'>elems</span> <span class='op'>=</span> <span class='const'>OPTIONS</span><span class='lbracket'>[</span><span class='symbol'>:elements</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id elems'>elems</span> <span class='op'>||</span> <span class='id elems'>elems</span><span class='period'>.</span><span class='id empty?'>empty?</span>

    <span class='id regexps'>regexps</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id regexp'>regexp</span><span class='op'>|</span>

        <span class='id string'>string</span><span class='period'>.</span><span class='id scan'>scan</span><span class='lparen'>(</span> <span class='id regexp'>regexp</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id flatten'>flatten</span><span class='period'>.</span><span class='id uniq'>uniq</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
            <span class='op'>|</span><span class='id match'>match</span><span class='op'>|</span>

            <span class='kw'>next</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id match'>match</span>
            <span class='kw'>next</span> <span class='kw'>if</span> <span class='id block'>block</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id block'>block</span><span class='period'>.</span><span class='id call'>call</span><span class='lparen'>(</span> <span class='id match'>match</span> <span class='rparen'>)</span>

            <span class='id log'>log</span><span class='lparen'>(</span>
                <span class='symbol'>:regexp</span>  <span class='op'>=&gt;</span> <span class='id regexp'>regexp</span><span class='comma'>,</span>
                <span class='symbol'>:match</span>   <span class='op'>=&gt;</span> <span class='id match'>match</span><span class='comma'>,</span>
                <span class='symbol'>:element</span> <span class='op'>=&gt;</span> <span class='const'>Issue</span><span class='op'>::</span><span class='const'>Element</span><span class='op'>::</span><span class='const'>BODY</span>
            <span class='rparen'>)</span>
        <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id elems'>elems</span><span class='period'>.</span><span class='id include?'>include?</span> <span class='const'>Issue</span><span class='op'>::</span><span class='const'>Element</span><span class='op'>::</span><span class='const'>BODY</span>

        <span class='kw'>next</span> <span class='kw'>if</span> <span class='id string'>string</span> <span class='op'>==</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id html'>html</span>

        <span class='ivar'>@page</span><span class='period'>.</span><span class='id response_headers'>response_headers</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
            <span class='op'>|</span><span class='id k'>k</span><span class='comma'>,</span><span class='id v'>v</span><span class='op'>|</span>
            <span class='kw'>next</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id v'>v</span>

            <span class='id v'>v</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='period'>.</span><span class='id scan'>scan</span><span class='lparen'>(</span> <span class='id regexp'>regexp</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id flatten'>flatten</span><span class='period'>.</span><span class='id uniq'>uniq</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
                <span class='op'>|</span><span class='id match'>match</span><span class='op'>|</span>

                <span class='kw'>next</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id match'>match</span>
                <span class='kw'>next</span> <span class='kw'>if</span> <span class='id block'>block</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id block'>block</span><span class='period'>.</span><span class='id call'>call</span><span class='lparen'>(</span> <span class='id match'>match</span> <span class='rparen'>)</span>

                <span class='id log'>log</span><span class='lparen'>(</span>
                    <span class='symbol'>:var</span> <span class='op'>=&gt;</span> <span class='id k'>k</span><span class='comma'>,</span>
                    <span class='symbol'>:regexp</span>  <span class='op'>=&gt;</span> <span class='id regexp'>regexp</span><span class='comma'>,</span>
                    <span class='symbol'>:match</span>   <span class='op'>=&gt;</span> <span class='id match'>match</span><span class='comma'>,</span>
                    <span class='symbol'>:element</span> <span class='op'>=&gt;</span> <span class='const'>Issue</span><span class='op'>::</span><span class='const'>Element</span><span class='op'>::</span><span class='const'>HEADER</span>
                <span class='rparen'>)</span>
            <span class='rbrace'>}</span>
        <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id elems'>elems</span><span class='period'>.</span><span class='id include?'>include?</span> <span class='const'>Issue</span><span class='op'>::</span><span class='const'>Element</span><span class='op'>::</span><span class='const'>HEADER</span>

    <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="skip?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>skip?</strong>(elem) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
ABSTRACT - OPTIONAL
</p>
<p>
This is called right before an [Arachni::Parser::Element] is
submitted/auditted and is used to determine whether to skip it or not.
</p>
<p>
Implementation details are left up to the running module.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../Parser/Element.html" title="Arachni::Parser::Element (module)">Arachni::Parser::Element</a></span></tt>)</span>
      
      
        <span class='name'>elem</span>
      
      
      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


312
313
314</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 312</span>

<span class='kw'>def</span> <span class='id skip?'>skip?</span><span class='lparen'>(</span> <span class='id elem'>elem</span> <span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="timing_attack-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>timing_attack</strong>(strings, opts, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Audits elements using a timing attack.
</p>
<p>
&#8216;opts&#8217; needs to contain a :timeout value in milliseconds.</br>
Optionally, you can add a :timeout_divider.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
        <span class='name'>strings</span>
      
      
      
        &mdash;
        <div class='inline'><p>
injection strings &#8216;<em>TIME</em>&#8217; will be substituded with
(timeout / timeout_divider)
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>opts</span>
      
      
      
        &mdash;
        <div class='inline'><p>
options as described in <span class='object_link'><a href="#OPTIONS-constant" title="Arachni::Module::Auditor::OPTIONS (constant)">OPTIONS</a></span>
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Block</tt>)</span>
      
      
        <span class='name'>&amp;block</span>
      
      
      
        &mdash;
        <div class='inline'><p>
block to call if a timeout occurs, it will be passed the response and opts
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


394
395
396
397
398
399
400
401
402
403
404
405
406
407</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 394</span>

<span class='kw'>def</span> <span class='id timing_attack'>timing_attack</span><span class='lparen'>(</span> <span class='id strings'>strings</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>

    <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:timeout_divider</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='int'>1</span>
    <span class='lbracket'>[</span><span class='id strings'>strings</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id flatten'>flatten</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id str'>str</span><span class='op'>|</span>

        <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:timing_string</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id str'>str</span>
        <span class='id str'>str</span> <span class='op'>=</span> <span class='id str'>str</span><span class='period'>.</span><span class='id gsub'>gsub</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>__TIME__</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='lparen'>(</span> <span class='lparen'>(</span><span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:timeout</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='int'>3000</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:timeout_divider</span><span class='rbracket'>]</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='rparen'>)</span>
        <span class='id audit'>audit</span><span class='lparen'>(</span> <span class='id str'>str</span><span class='comma'>,</span> <span class='id opts'>opts</span> <span class='rparen'>)</span> <span class='lbrace'>{</span>
            <span class='op'>|</span><span class='id res'>res</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='id elem'>elem</span><span class='op'>|</span>
            <span class='id block'>block</span><span class='period'>.</span><span class='id call'>call</span><span class='lparen'>(</span> <span class='id res'>res</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='id elem'>elem</span> <span class='rparen'>)</span> <span class='kw'>if</span> <span class='id block'>block</span> <span class='op'>&amp;&amp;</span> <span class='id res'>res</span><span class='period'>.</span><span class='id timed_out?'>timed_out?</span>
        <span class='rbrace'>}</span>
    <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Wed Mar 23 02:13:27 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.5 (ruby-1.9.2).
</div>

  </body>
</html>