<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Module: Arachni::Module::Auditor</title>
<link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (A)</a> &raquo; 
    <span class='title'><a href="../../Arachni.html" title="Arachni (module)">Arachni</a></span> &raquo; <span class='title'><a href="../Module.html" title="Arachni::Module (module)">Module</a></span>
     &raquo; 
    <span class="title">Auditor</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Module: Arachni::Module::Auditor
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
    <dt class="r1">Included in:</dt>
    <dd class="r1"><a href="Base.html" title="Arachni::Module::Base (class)">Base</a></dd>
    
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/module/auditor.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
Auditor module
</p>
<p>
Included by <tt><a href="Base.html" title="Arachni::Module::Base (class)">Base</a></tt>.<br/> Includes audit methods used to attack a
web page.
</p>
<p>
@author: Anastasios &#8220;Zapotek&#8221; Laskos
</p>
<pre class="code">
                                     &lt;tasos.laskos@gmail.com&gt;
                                     &lt;zapotek@segfault.gr&gt;
</pre>
<p>
@version: 0.1
</p>


  </div>
</div>
<div class="tags">
  
</div>


  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#audit_cookies-instance_method" title="#audit_cookies (instance method)">- (Object) <strong>audit_cookies</strong>(injection_str, id_regex = nil, id = nil, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Audits cookies injecting the injection_str as value for the cookies and
then matching the response body against the id_regex.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#audit_forms-instance_method" title="#audit_forms (instance method)">- (Object) <strong>audit_forms</strong>(injection_str, id_regex = nil, id = nil, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Audits forms injecting the injection_str as value for the variables and
then matching the response body against the id_regex.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#audit_headers-instance_method" title="#audit_headers (instance method)">- (Object) <strong>audit_headers</strong>(injection_str, id_regex = nil, id = nil, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Audits HTTP request headers injecting the injection_str as values and then
matching the response body against the id_regex.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#audit_links-instance_method" title="#audit_links (instance method)">- (Object) <strong>audit_links</strong>(injection_str, id_regex = nil, id = nil, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Audits links injecting the injection_str as value for the variables and
then matching the response body against the id_regex.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_matches-instance_method" title="#get_matches (instance method)">- (Object) <strong>get_matches</strong>(where, var, res, injection_str, id_regex, id, url) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inject_each_var-instance_method" title="#inject_each_var (instance method)">- (Array) <strong>inject_each_var</strong>(hash, to_inj) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Iterates through a hash setting each value to to_inj and returns an array
of new hashes.
</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="audit_cookies-instance_method">
  
    - (<tt>Object</tt>) <strong>audit_cookies</strong>(injection_str, id_regex = nil, id = nil, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Audits cookies injecting the injection_str as value for the cookies and
then matching the response body against the id_regex.
</p>
<p>
If the id argument has been provided the matched data of the id_regex will
be ==&#8217;ed against it.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>injection_str</span>
      
      
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>id_regex</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
regular expression string
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>id</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
string to double check the id_regex matched data
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Block</tt>)</span>
      
      
        <span class='name'>block</span>
      
      
      
        &mdash;
        <div class='inline'><p>
to be executed right after the request has been made. It will be passed the
currently audited variable, the response and the url.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Array&lt;Hash&lt;String, String&gt;&gt;</tt>)</span>
      
      
        <span class='name'>the</span>
      
      
      
        &mdash;
        <div class='inline'><p>
positive results of the audit, if no block has been given
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 273</span>

<span class='kw'>def</span> <span class='id audit_cookies'>audit_cookies</span><span class='lparen'>(</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id id_regex'>id_regex</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id id'>id</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>
    
    <span class='id results'>results</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    
    <span class='comment'># iterate through each cookie
</span>    <span class='id work_on_cookies'>work_on_cookies</span> <span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id orig_cookie'>orig_cookie</span><span class='op'>|</span>
    <span class='id inject_each_var'>inject_each_var</span><span class='lparen'>(</span> <span class='id get_cookie_simple'>get_cookie_simple</span><span class='lparen'>(</span> <span class='id orig_cookie'>orig_cookie</span> <span class='rparen'>)</span><span class='comma'>,</span> <span class='id injection_str'>injection_str</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id cookie'>cookie</span><span class='op'>|</span>

        <span class='kw'>next</span> <span class='kw'>if</span> <span class='const'>Options</span><span class='period'>.</span><span class='id instance'>instance</span><span class='period'>.</span><span class='id exclude_cookies'>exclude_cookies</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span> <span class='id cookie'>cookie</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>altered</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='rparen'>)</span>
        
        <span class='id audit_id'>audit_id</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='period'>.</span><span class='id info'>info</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Name</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@page</span><span class='period'>.</span><span class='id url'>url</span><span class='rbrace'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='const'>Vulnerability</span><span class='op'>::</span><span class='const'>Element</span><span class='op'>::</span><span class='const'>COOKIE</span><span class='rbrace'>}</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id cookie'>cookie</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>altered</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_content'>=</span><span class='embexpr_beg'>#{</span><span class='id cookie'>cookie</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hash</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
        
        <span class='kw'>next</span> <span class='kw'>if</span> <span class='cvar'>@@audited</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span> <span class='id audit_id'>audit_id</span> <span class='rparen'>)</span>

        <span class='comment'># tell the user what we're auditing
</span>        <span class='id print_status'>print_status</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Auditing cookie '</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
            <span class='id cookie'>cookie</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>altered</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>' of </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id url'>url</span> <span class='rparen'>)</span>

        <span class='comment'># make a get request with our cookies
</span>        <span class='id res'>res</span> <span class='op'>=</span> <span class='ivar'>@http</span><span class='period'>.</span><span class='id cookie'>cookie</span><span class='lparen'>(</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id url'>url</span><span class='comma'>,</span> <span class='id cookie'>cookie</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hash</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='kw'>nil</span> <span class='rparen'>)</span>
            
        <span class='cvar'>@@audited</span> <span class='op'>&lt;&lt;</span> <span class='id audit_id'>audit_id</span>

        <span class='comment'># check for a response
</span>        <span class='kw'>if</span> <span class='op'>!</span><span class='id res'>res</span> <span class='kw'>then</span> <span class='kw'>next</span> <span class='kw'>end</span>
        
        <span class='kw'>if</span> <span class='id block_given?'>block_given?</span>
            <span class='id block'>block</span><span class='period'>.</span><span class='id call'>call</span><span class='lparen'>(</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id url'>url</span><span class='comma'>,</span> <span class='id res'>res</span><span class='comma'>,</span> <span class='id cookie'>cookie</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>altered</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='rparen'>)</span>
            <span class='kw'>next</span>
        <span class='kw'>end</span>
        
        <span class='kw'>if</span> <span class='op'>!</span><span class='id res'>res</span><span class='period'>.</span><span class='id body'>body</span> <span class='kw'>then</span> <span class='kw'>next</span> <span class='kw'>end</span>
            
        <span class='comment'># get possible matches
</span>        <span class='id result'>result</span> <span class='op'>=</span> <span class='id get_matches'>get_matches</span><span class='lparen'>(</span> <span class='const'>Vulnerability</span><span class='op'>::</span><span class='const'>Element</span><span class='op'>::</span><span class='const'>COOKIE</span><span class='comma'>,</span>
            <span class='id cookie'>cookie</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>altered</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id res'>res</span><span class='comma'>,</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id id_regex'>id_regex</span><span class='comma'>,</span> <span class='id id'>id</span><span class='comma'>,</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id url'>url</span> <span class='rparen'>)</span>
        <span class='comment'># and append them
</span>        <span class='id results'>results</span> <span class='op'>&lt;&lt;</span> <span class='id result'>result</span> <span class='kw'>if</span> <span class='id result'>result</span>
    <span class='rbrace'>}</span>
    <span class='rbrace'>}</span>

    <span class='id results'>results</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="audit_forms-instance_method">
  
    - (<tt>Object</tt>) <strong>audit_forms</strong>(injection_str, id_regex = nil, id = nil, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Audits forms injecting the injection_str as value for the variables and
then matching the response body against the id_regex.
</p>
<p>
If the id argument has been provided the matched data of the id_regex will
be ==&#8217;ed against it.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>injection_str</span>
      
      
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>id_regex</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
regular expression string
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>id</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
string to double check the id_regex matched data
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Block</tt>)</span>
      
      
        <span class='name'>block</span>
      
      
      
        &mdash;
        <div class='inline'><p>
to be executed right after the request has been made. It will be passed the
currently audited variable, the response and the url.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Array&lt;Hash&lt;String, String&gt;&gt;</tt>)</span>
      
      
        <span class='name'>the</span>
      
      
      
        &mdash;
        <div class='inline'><p>
positive results of the audit, if no block has been given
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 194</span>

<span class='kw'>def</span> <span class='id audit_forms'>audit_forms</span><span class='lparen'>(</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id id_regex'>id_regex</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id id'>id</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>
    
    <span class='id results'>results</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    
    <span class='id work_on_forms'>work_on_forms</span> <span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id orig_form'>orig_form</span><span class='op'>|</span>
        <span class='id form'>form</span> <span class='op'>=</span> <span class='id get_form_simple'>get_form_simple</span><span class='lparen'>(</span> <span class='id orig_form'>orig_form</span> <span class='rparen'>)</span>

        <span class='kw'>next</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id form'>form</span>
        
        <span class='id url'>url</span>    <span class='op'>=</span> <span class='id form'>form</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>attrs</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>action</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
        <span class='id method'>method</span> <span class='op'>=</span> <span class='id form'>form</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>attrs</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>method</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
            
        <span class='comment'># iterate through each auditable element
</span>        <span class='id inject_each_var'>inject_each_var</span><span class='lparen'>(</span> <span class='id form'>form</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>auditable</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id injection_str'>injection_str</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
            <span class='op'>|</span><span class='id input'>input</span><span class='op'>|</span>

            <span class='id audit_id'>audit_id</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='period'>.</span><span class='id info'>info</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Name</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id url'>url</span><span class='rbrace'>}</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Vulnerability</span><span class='op'>::</span><span class='const'>Element</span><span class='op'>::</span><span class='const'>FORM</span><span class='rbrace'>}</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> 
                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id input'>input</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>altered</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_content'>=</span><span class='embexpr_beg'>#{</span><span class='id input'>input</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hash</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
            
            <span class='kw'>next</span> <span class='kw'>if</span> <span class='cvar'>@@audited</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span> <span class='id audit_id'>audit_id</span> <span class='rparen'>)</span>
            
            <span class='comment'># inform the user what we're auditing
</span>            <span class='id print_status'>print_status</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Auditing form input '</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
                <span class='id input'>input</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>altered</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>' with action </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id url'>url</span> <span class='rparen'>)</span>

            <span class='kw'>if</span><span class='lparen'>(</span> <span class='id method'>method</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>get</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span>
                <span class='id res'>res</span> <span class='op'>=</span> <span class='ivar'>@http</span><span class='period'>.</span><span class='id post'>post</span><span class='lparen'>(</span> <span class='id url'>url</span><span class='comma'>,</span> <span class='id input'>input</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hash</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='rparen'>)</span>
            <span class='kw'>else</span>
                <span class='id res'>res</span> <span class='op'>=</span> <span class='ivar'>@http</span><span class='period'>.</span><span class='id get'>get</span><span class='lparen'>(</span> <span class='id url'>url</span><span class='comma'>,</span> <span class='id input'>input</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hash</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='rparen'>)</span>
            <span class='kw'>end</span>
            
            <span class='cvar'>@@audited</span> <span class='op'>&lt;&lt;</span> <span class='id audit_id'>audit_id</span>
            
            <span class='comment'># make sure that we have a response before continuing
</span>            <span class='kw'>if</span> <span class='op'>!</span><span class='id res'>res</span> <span class='kw'>then</span> <span class='kw'>next</span> <span class='kw'>end</span>
            
            <span class='comment'># call the block, if there's one
</span>            <span class='kw'>if</span> <span class='id block_given?'>block_given?</span>
                <span class='id block'>block</span><span class='period'>.</span><span class='id call'>call</span><span class='lparen'>(</span> <span class='id url'>url</span><span class='comma'>,</span> <span class='id res'>res</span><span class='comma'>,</span> <span class='id input'>input</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>altered</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='rparen'>)</span>
                <span class='kw'>next</span>
            <span class='kw'>end</span>

            <span class='kw'>if</span> <span class='op'>!</span><span class='id res'>res</span><span class='period'>.</span><span class='id body'>body</span> <span class='kw'>then</span> <span class='kw'>next</span> <span class='kw'>end</span>
        
            <span class='comment'># get matches
</span>            <span class='id result'>result</span> <span class='op'>=</span> <span class='id get_matches'>get_matches</span><span class='lparen'>(</span> <span class='const'>Vulnerability</span><span class='op'>::</span><span class='const'>Element</span><span class='op'>::</span><span class='const'>FORM</span><span class='comma'>,</span>
                <span class='id input'>input</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>altered</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id res'>res</span><span class='comma'>,</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id id_regex'>id_regex</span><span class='comma'>,</span> <span class='id id'>id</span><span class='comma'>,</span> <span class='id url'>url</span> <span class='rparen'>)</span>
            
            <span class='comment'># and append them to the results array
</span>            <span class='id results'>results</span> <span class='op'>&lt;&lt;</span> <span class='id result'>result</span> <span class='kw'>if</span> <span class='id result'>result</span>
        <span class='rbrace'>}</span>
    <span class='rbrace'>}</span>
    <span class='id results'>results</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="audit_headers-instance_method">
  
    - (<tt>Object</tt>) <strong>audit_headers</strong>(injection_str, id_regex = nil, id = nil, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Audits HTTP request headers injecting the injection_str as values and then
matching the response body against the id_regex.
</p>
<p>
If the id argument has been provided the matched data of the id_regex will
be ==&#8217;ed against it.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>injection_str</span>
      
      
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>id_regex</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
regular expression string
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>id</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
string to double check the id_regex matched data
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Block</tt>)</span>
      
      
        <span class='name'>block</span>
      
      
      
        &mdash;
        <div class='inline'><p>
to be executed right after the request has been made. It will be passed the
currently audited variable, the response and the url.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Array&lt;Hash&lt;String, String&gt;&gt;</tt>)</span>
      
      
        <span class='name'>the</span>
      
      
      
        &mdash;
        <div class='inline'><p>
positive results of the audit, if no block has been given
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 52</span>

<span class='kw'>def</span> <span class='id audit_headers'>audit_headers</span><span class='lparen'>(</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id id_regex'>id_regex</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id id'>id</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>

    <span class='id results'>results</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    
    <span class='comment'># iterate through header fields and audit each one
</span>    <span class='id inject_each_var'>inject_each_var</span><span class='lparen'>(</span> <span class='id get_request_headers'>get_request_headers</span><span class='lparen'>(</span> <span class='kw'>true</span> <span class='rparen'>)</span><span class='comma'>,</span> <span class='id injection_str'>injection_str</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id vars'>vars</span><span class='op'>|</span>

        <span class='id audit_id'>audit_id</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='period'>.</span><span class='id info'>info</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Name</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@page</span><span class='period'>.</span><span class='id url'>url</span><span class='rbrace'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='const'>Vulnerability</span><span class='op'>::</span><span class='const'>Element</span><span class='op'>::</span><span class='const'>HEADER</span><span class='rbrace'>}</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id vars'>vars</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>altered</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_content'>=</span><span class='embexpr_beg'>#{</span><span class='id vars'>vars</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hash</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
        
        <span class='kw'>next</span> <span class='kw'>if</span> <span class='cvar'>@@audited</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span> <span class='id audit_id'>audit_id</span> <span class='rparen'>)</span>

        <span class='comment'># tell the user what we're doing
</span>        <span class='id print_status'>print_status</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Auditing header field '</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
            <span class='id vars'>vars</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>altered</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>' of </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id url'>url</span> <span class='rparen'>)</span>
        
        <span class='comment'># audit the url vars
</span>        <span class='id res'>res</span> <span class='op'>=</span> <span class='ivar'>@http</span><span class='period'>.</span><span class='id header'>header</span><span class='lparen'>(</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id url'>url</span><span class='comma'>,</span> <span class='id vars'>vars</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hash</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='rparen'>)</span>
        <span class='cvar'>@@audited</span> <span class='op'>&lt;&lt;</span> <span class='id audit_id'>audit_id</span>

        <span class='comment'># something might have gone bad,
</span>        <span class='comment'># make sure it doesn't ruin the rest of the show...
</span>        <span class='kw'>if</span> <span class='op'>!</span><span class='id res'>res</span> <span class='kw'>then</span> <span class='kw'>next</span> <span class='kw'>end</span>
        
        <span class='comment'># call the passed block
</span>        <span class='kw'>if</span> <span class='id block_given?'>block_given?</span>
            <span class='id block'>block</span><span class='period'>.</span><span class='id call'>call</span><span class='lparen'>(</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id url'>url</span><span class='comma'>,</span> <span class='id res'>res</span><span class='comma'>,</span> <span class='id vars'>vars</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>altered</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='rparen'>)</span>
            <span class='kw'>next</span>
        <span class='kw'>end</span>
        
        <span class='kw'>if</span> <span class='op'>!</span><span class='id res'>res</span><span class='period'>.</span><span class='id body'>body</span> <span class='kw'>then</span> <span class='kw'>next</span> <span class='kw'>end</span>
        
        <span class='comment'># get matches
</span>        <span class='id result'>result</span> <span class='op'>=</span> <span class='id get_matches'>get_matches</span><span class='lparen'>(</span> <span class='const'>Vulnerability</span><span class='op'>::</span><span class='const'>Element</span><span class='op'>::</span><span class='const'>HEADER</span><span class='comma'>,</span>
            <span class='id vars'>vars</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>altered</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id res'>res</span><span class='comma'>,</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id id_regex'>id_regex</span><span class='comma'>,</span> <span class='id id'>id</span><span class='comma'>,</span> <span class='ivar'>@page</span><span class='period'>.</span><span class='id url'>url</span> <span class='rparen'>)</span>
        
        <span class='comment'># and append them to the results array
</span>        <span class='id results'>results</span> <span class='op'>&lt;&lt;</span> <span class='id result'>result</span> <span class='kw'>if</span> <span class='id result'>result</span>
    <span class='rbrace'>}</span>

    <span class='id results'>results</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="audit_links-instance_method">
  
    - (<tt>Object</tt>) <strong>audit_links</strong>(injection_str, id_regex = nil, id = nil, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Audits links injecting the injection_str as value for the variables and
then matching the response body against the id_regex.
</p>
<p>
If the id argument has been provided the matched data of the id_regex will
be ==&#8217;ed against it.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>injection_str</span>
      
      
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>id_regex</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
regular expression string
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>id</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
string to double check the id_regex matched data
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Block</tt>)</span>
      
      
        <span class='name'>block</span>
      
      
      
        &mdash;
        <div class='inline'><p>
to be executed right after the request has been made. It will be passed the
currently audited variable, the response and the url.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Array&lt;Hash&lt;String, String&gt;&gt;</tt>)</span>
      
      
        <span class='name'>the</span>
      
      
      
        &mdash;
        <div class='inline'><p>
positive results of the audit, if no block has been given
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 118</span>

<span class='kw'>def</span> <span class='id audit_links'>audit_links</span><span class='lparen'>(</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id id_regex'>id_regex</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id id'>id</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span> <span class='rparen'>)</span>

    <span class='id results'>results</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    
    <span class='id work_on_links'>work_on_links</span> <span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id link'>link</span><span class='op'>|</span>
        
        <span class='id url'>url</span>       <span class='op'>=</span> <span class='id link'>link</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>href</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
        <span class='id link_vars'>link_vars</span> <span class='op'>=</span> <span class='id link'>link</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>vars</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
            
        <span class='comment'># if we don't have any auditable elements just return
</span>        <span class='kw'>if</span> <span class='op'>!</span><span class='id link_vars'>link_vars</span> <span class='kw'>then</span> <span class='kw'>next</span> <span class='kw'>end</span>

        <span class='comment'># iterate through all url vars and audit each one
</span>        <span class='id inject_each_var'>inject_each_var</span><span class='lparen'>(</span> <span class='id link_vars'>link_vars</span><span class='comma'>,</span> <span class='id injection_str'>injection_str</span> <span class='rparen'>)</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
            <span class='op'>|</span><span class='id vars'>vars</span><span class='op'>|</span>

            <span class='id audit_id'>audit_id</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='period'>.</span><span class='id info'>info</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Name</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id url'>url</span><span class='rbrace'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='const'>Vulnerability</span><span class='op'>::</span><span class='const'>Element</span><span class='op'>::</span><span class='const'>LINK</span><span class='rbrace'>}</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
                <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id vars'>vars</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>altered</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_content'>=</span><span class='embexpr_beg'>#{</span><span class='id vars'>vars</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hash</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
            
            <span class='kw'>next</span> <span class='kw'>if</span> <span class='cvar'>@@audited</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span> <span class='id audit_id'>audit_id</span> <span class='rparen'>)</span>

            <span class='comment'># tell the user what we're doing
</span>            <span class='id print_status'>print_status</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Auditing link var '</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
                <span class='id vars'>vars</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>altered</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>' of </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id url'>url</span> <span class='rparen'>)</span>
            
            <span class='comment'># audit the url vars
</span>            <span class='id res'>res</span> <span class='op'>=</span> <span class='ivar'>@http</span><span class='period'>.</span><span class='id get'>get</span><span class='lparen'>(</span> <span class='id url'>url</span><span class='comma'>,</span> <span class='id vars'>vars</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hash</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='rparen'>)</span>
            <span class='cvar'>@@audited</span> <span class='op'>&lt;&lt;</span> <span class='id audit_id'>audit_id</span>
            
            <span class='comment'># something might have gone bad,
</span>            <span class='comment'># make sure it doesn't ruin the rest of the show...
</span>            <span class='kw'>if</span> <span class='op'>!</span><span class='id res'>res</span> <span class='kw'>then</span> <span class='kw'>next</span> <span class='kw'>end</span>
            
            <span class='comment'># call the passed block
</span>            <span class='kw'>if</span> <span class='id block_given?'>block_given?</span>
                <span class='id block'>block</span><span class='period'>.</span><span class='id call'>call</span><span class='lparen'>(</span> <span class='id url'>url</span><span class='comma'>,</span> <span class='id res'>res</span><span class='comma'>,</span> <span class='id vars'>vars</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>altered</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='rparen'>)</span>
                <span class='kw'>next</span>
            <span class='kw'>end</span>
            
            <span class='kw'>if</span> <span class='op'>!</span><span class='id res'>res</span><span class='period'>.</span><span class='id body'>body</span> <span class='kw'>then</span> <span class='kw'>next</span> <span class='kw'>end</span>
            
            <span class='comment'># get matches
</span>            <span class='id result'>result</span> <span class='op'>=</span> <span class='id get_matches'>get_matches</span><span class='lparen'>(</span> <span class='const'>Vulnerability</span><span class='op'>::</span><span class='const'>Element</span><span class='op'>::</span><span class='const'>LINK</span><span class='comma'>,</span>
                <span class='id vars'>vars</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>altered</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id res'>res</span><span class='comma'>,</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id id_regex'>id_regex</span><span class='comma'>,</span> <span class='id id'>id</span><span class='comma'>,</span> <span class='id url'>url</span> <span class='rparen'>)</span>
            
            <span class='comment'># and append them to the results array
</span>            <span class='id results'>results</span> <span class='op'>&lt;&lt;</span> <span class='id result'>result</span> <span class='kw'>if</span> <span class='id result'>result</span>
        <span class='rbrace'>}</span>
    <span class='rbrace'>}</span>    

    <span class='id results'>results</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_matches-instance_method">
  
    - (<tt>Object</tt>) <strong>get_matches</strong>(where, var, res, injection_str, id_regex, id, url) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 321</span>

<span class='kw'>def</span> <span class='id get_matches'>get_matches</span><span class='lparen'>(</span> <span class='id where'>where</span><span class='comma'>,</span> <span class='id var'>var</span><span class='comma'>,</span> <span class='id res'>res</span><span class='comma'>,</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span> <span class='id id_regex'>id_regex</span><span class='comma'>,</span> <span class='id id'>id</span><span class='comma'>,</span> <span class='id url'>url</span> <span class='rparen'>)</span>
    
    <span class='comment'># fairly obscure condition...pardon me...
</span>    <span class='kw'>if</span> <span class='lparen'>(</span> <span class='id id'>id</span> <span class='op'>&amp;&amp;</span> <span class='id res'>res</span><span class='period'>.</span><span class='id body'>body</span><span class='period'>.</span><span class='id scan'>scan</span><span class='lparen'>(</span> <span class='id id_regex'>id_regex</span> <span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='id id'>id</span> <span class='rparen'>)</span> <span class='op'>||</span>
       <span class='lparen'>(</span> <span class='op'>!</span><span class='id id'>id</span> <span class='op'>&amp;&amp;</span> <span class='id res'>res</span><span class='period'>.</span><span class='id body'>body</span><span class='period'>.</span><span class='id scan'>scan</span><span class='lparen'>(</span> <span class='id id_regex'>id_regex</span> <span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id size'>size</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='rparen'>)</span>
    
        <span class='id print_ok'>print_ok</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>In </span><span class='embexpr_beg'>#{</span><span class='id where'>where</span><span class='rbrace'>}</span><span class='tstring_content'> var '</span><span class='embexpr_beg'>#{</span><span class='id var'>var</span><span class='rbrace'>}</span><span class='tstring_content'>' </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'> ( </span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id url'>url</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'> )</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span>
        
        <span class='id print_verbose'>print_verbose</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Injected str:\t</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id injection_str'>injection_str</span> <span class='rparen'>)</span>    
        <span class='id print_verbose'>print_verbose</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID str:\t</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id id'>id</span> <span class='rparen'>)</span>
        <span class='id print_verbose'>print_verbose</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Matched regex: </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id id_regex'>id_regex</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='rparen'>)</span>
        <span class='id print_verbose'>print_verbose</span><span class='lparen'>(</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>---------</span><span class='tstring_end'>'</span></span> <span class='rparen'>)</span> <span class='kw'>if</span> <span class='id only_positives?'>only_positives?</span>

        <span class='kw'>return</span> <span class='lbrace'>{</span>
            <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>var</span><span class='tstring_end'>'</span></span>          <span class='op'>=&gt;</span> <span class='id var'>var</span><span class='comma'>,</span>
            <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>url</span><span class='tstring_end'>'</span></span>          <span class='op'>=&gt;</span> <span class='id url'>url</span><span class='comma'>,</span>
            <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>injected</span><span class='tstring_end'>'</span></span>     <span class='op'>=&gt;</span> <span class='id injection_str'>injection_str</span><span class='comma'>,</span>
            <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>id</span><span class='tstring_end'>'</span></span>           <span class='op'>=&gt;</span> <span class='id id'>id</span><span class='comma'>,</span>
            <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>regexp</span><span class='tstring_end'>'</span></span>       <span class='op'>=&gt;</span> <span class='id id_regex'>id_regex</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='comma'>,</span>
            <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>regexp_match</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id res'>res</span><span class='period'>.</span><span class='id body'>body</span><span class='period'>.</span><span class='id scan'>scan</span><span class='lparen'>(</span> <span class='id id_regex'>id_regex</span> <span class='rparen'>)</span><span class='comma'>,</span>
            <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>response</span><span class='tstring_end'>'</span></span>     <span class='op'>=&gt;</span> <span class='id res'>res</span><span class='period'>.</span><span class='id body'>body</span><span class='comma'>,</span>
            <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>elem</span><span class='tstring_end'>'</span></span>         <span class='op'>=&gt;</span> <span class='id where'>where</span><span class='comma'>,</span>
            <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>headers</span><span class='tstring_end'>'</span></span>      <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
                <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>request</span><span class='tstring_end'>'</span></span>    <span class='op'>=&gt;</span> <span class='id get_request_headers'>get_request_headers</span><span class='lparen'>(</span> <span class='rparen'>)</span><span class='comma'>,</span>
                <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>response</span><span class='tstring_end'>'</span></span>   <span class='op'>=&gt;</span> <span class='id get_response_headers'>get_response_headers</span><span class='lparen'>(</span> <span class='id res'>res</span> <span class='rparen'>)</span><span class='comma'>,</span>    
            <span class='rbrace'>}</span>
        <span class='rbrace'>}</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="inject_each_var-instance_method">
  
    - (<tt>Array</tt>) <strong>inject_each_var</strong>(hash, to_inj) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Iterates through a hash setting each value to to_inj and returns an array
of new hashes
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>hash</span>
      
      
      
        &mdash;
        <div class='inline'><p>
name=>value pairs
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>to_inj</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the string to inject
</p>
</div>
      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/module/auditor.rb', line 360</span>

<span class='kw'>def</span> <span class='id inject_each_var'>inject_each_var</span><span class='lparen'>(</span> <span class='id hash'>hash</span><span class='comma'>,</span> <span class='id to_inj'>to_inj</span> <span class='rparen'>)</span>
    
    <span class='id var_combo'>var_combo</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='kw'>if</span><span class='lparen'>(</span> <span class='op'>!</span><span class='id hash'>hash</span> <span class='op'>||</span> <span class='id hash'>hash</span><span class='period'>.</span><span class='id size'>size</span> <span class='op'>==</span> <span class='int'>0</span> <span class='rparen'>)</span> <span class='kw'>then</span> <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>end</span>
    
    <span class='comment'># this is the original hash, in case the default values
</span>    <span class='comment'># are valid and present us with new attack vectors
</span>    <span class='id as_is'>as_is</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span> <span class='rparen'>)</span>
    <span class='id as_is'>as_is</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>altered</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>__orig</span><span class='tstring_end'>'</span></span>
    <span class='id chash'>chash</span> <span class='op'>=</span> <span class='id as_is'>as_is</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hash</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>    <span class='op'>=</span> <span class='id hash'>hash</span><span class='period'>.</span><span class='id clone'>clone</span>
        
    <span class='id as_is'>as_is</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hash</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id keys'>keys</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id k'>k</span><span class='op'>|</span>
        <span class='kw'>if</span><span class='lparen'>(</span> <span class='op'>!</span><span class='id as_is'>as_is</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hash</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id k'>k</span><span class='rbracket'>]</span> <span class='rparen'>)</span> <span class='kw'>then</span> <span class='id as_is'>as_is</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hash</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span> <span class='kw'>end</span>
    <span class='rbrace'>}</span>
    <span class='id var_combo'>var_combo</span> <span class='op'>&lt;&lt;</span> <span class='id as_is'>as_is</span>
    
    <span class='comment'># these are audit inputs, if a value is empty or null
</span>    <span class='comment'># we put a sample e-mail address in its place
</span>    <span class='id hash'>hash</span><span class='period'>.</span><span class='id keys'>keys</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id k'>k</span><span class='op'>|</span>
        
        <span class='id hash'>hash</span> <span class='op'>=</span> <span class='const'>KeyFiller</span><span class='period'>.</span><span class='id fill'>fill</span><span class='lparen'>(</span> <span class='id hash'>hash</span> <span class='rparen'>)</span>
        
        <span class='id var_combo'>var_combo</span> <span class='op'>&lt;&lt;</span> <span class='lbrace'>{</span> 
            <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>altered</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id k'>k</span><span class='comma'>,</span>
            <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hash</span><span class='tstring_end'>'</span></span>    <span class='op'>=&gt;</span> <span class='id hash'>hash</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span> <span class='lbrace'>{</span> <span class='id k'>k</span> <span class='op'>=&gt;</span> <span class='id hash'>hash</span><span class='lbracket'>[</span><span class='id k'>k</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id to_inj'>to_inj</span> <span class='rbrace'>}</span> <span class='rparen'>)</span>
        <span class='rbrace'>}</span>
    <span class='rbrace'>}</span>

    <span class='comment'>#
</span>    <span class='comment'># same as above but with null terminated injection strings
</span>    <span class='comment'>#
</span>    <span class='id chash'>chash</span><span class='period'>.</span><span class='id keys'>keys</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span>
        <span class='op'>|</span><span class='id k'>k</span><span class='op'>|</span>
        
        <span class='id chash'>chash</span> <span class='op'>=</span> <span class='const'>KeyFiller</span><span class='period'>.</span><span class='id fill'>fill</span><span class='lparen'>(</span> <span class='id chash'>chash</span> <span class='rparen'>)</span>
        
        <span class='id var_combo'>var_combo</span> <span class='op'>&lt;&lt;</span> <span class='lbrace'>{</span> 
            <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>altered</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id k'>k</span><span class='comma'>,</span>
            <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hash</span><span class='tstring_end'>'</span></span>    <span class='op'>=&gt;</span> <span class='id chash'>chash</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span> <span class='lbrace'>{</span> <span class='id k'>k</span> <span class='op'>=&gt;</span> <span class='id chash'>chash</span><span class='lbracket'>[</span><span class='id k'>k</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id to_inj'>to_inj</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\0</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span> <span class='rparen'>)</span>
        <span class='rbrace'>}</span>
    <span class='rbrace'>}</span>
    
    <span class='kw'>return</span> <span class='id var_combo'>var_combo</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Sat Sep  4 00:53:54 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>
  0.5.8 (ruby-1.9.1).
</div>

  </body>
</html>