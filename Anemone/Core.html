<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: Anemone::Core</title>
<link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (C)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../Anemone.html" title="Anemone (module)">Anemone</a></span></span>
     &raquo; 
    <span class="title">Core</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Anemone::Core
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">Anemone::Core</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="../Arachni/UI/Output.html" title="Arachni::UI::Output (module)">Arachni::UI::Output</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/anemone/core.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
Overides Anemone&#8217;s Core class method skip_link?( link ) to support
regexp matching to the whole url and enforce redundancy checks. <br/>
Messages were also added to inform the user in case of redundant URLs.
</p>
<p>
@author: Tasos &#8220;Zapotek&#8221; Laskos
</p>
<pre class="code">
                                     &lt;tasos.laskos@gmail.com&gt;
                                     &lt;zapotek@segfault.gr&gt;
</pre>
<p>
@version: 0.1
</p>


  </div>
</div>
<div class="tags">
  
</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="DEFAULT_OPTS-constant" class="">DEFAULT_OPTS =
          
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span>
  <span class='comment'># run 4 Tentacle threads to fetch pages
</span>  <span class='symbol'>:threads</span> <span class='op'>=&gt;</span> <span class='int'>4</span><span class='comma'>,</span>
  <span class='comment'># disable verbose output
</span>  <span class='symbol'>:verbose</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='comment'># don't throw away the page response body after scanning it for links
</span>  <span class='symbol'>:discard_page_bodies</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='comment'># identify self as Anemone/VERSION
</span>  <span class='symbol'>:user_agent</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Anemone/</span><span class='embexpr_beg'>#{</span><span class='const'>Anemone</span><span class='op'>::</span><span class='const'>VERSION</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='comment'># no delay between requests
</span>  <span class='symbol'>:delay</span> <span class='op'>=&gt;</span> <span class='int'>0</span><span class='comma'>,</span>
  <span class='comment'># don't obey the robots exclusion protocol
</span>  <span class='symbol'>:obey_robots_txt</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='comment'># by default, don't limit the depth of the crawl
</span>  <span class='symbol'>:depth_limit</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='comment'># number of times HTTP redirects will be followed
</span>  <span class='symbol'>:redirect_limit</span> <span class='op'>=&gt;</span> <span class='int'>5</span><span class='comma'>,</span>
  <span class='comment'># storage engine defaults to Hash in +process_options+ if none specified
</span>  <span class='symbol'>:storage</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span>
  <span class='comment'># Hash of cookie name =&gt; value to send with HTTP requests
</span>  <span class='symbol'>:cookies</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span>
  <span class='comment'># accept cookies from the server and send them back?
</span>  <span class='symbol'>:accept_cookies</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='comment'># skip any link with a query string? e.g. http://foo.com/?u=user
</span>  <span class='symbol'>:skip_query_strings</span> <span class='op'>=&gt;</span> <span class='kw'>false</span>
<span class='rbrace'>}</span></pre></dd>
      
    </dl>
  


  
  
  
  
  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#opts-instance_method" title="#opts (instance method)">- (Object) <strong>opts</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Hash of options for the crawl.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#pages-instance_method" title="#pages (instance method)">- (Object) <strong>pages</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
PageStore storing all Page objects encountered during the crawl.
</p>
</div></span>
  
</li>

    
  </ul>


  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#crawl-class_method" title="crawl (class method)">+ (Object) <strong>crawl</strong>(urls, opts = {}) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Convenience method to start a new crawl.
</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#after_crawl-instance_method" title="#after_crawl (instance method)">- (Object) <strong>after_crawl</strong>(&amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Add a block to be executed on the PageStore after the crawl is finished.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#focus_crawl-instance_method" title="#focus_crawl (instance method)">- (Object) <strong>focus_crawl</strong>(&amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Specify a block which will select which links to follow on each page.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Core) <strong>initialize</strong>(urls, opts = {}) {|_self| ... }</a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Initialize the crawl with starting <b>urls</b> (single URL or Array of
URLs) and optional <b>block</b>.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_every_page-instance_method" title="#on_every_page (instance method)">- (Object) <strong>on_every_page</strong>(&amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Add a block to be executed on every Page as they are encountered during the
crawl.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_pages_like-instance_method" title="#on_pages_like (instance method)">- (Object) <strong>on_pages_like</strong>(*patterns, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Add a block to be executed on Page objects with a URL matching one or more
patterns.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run-instance_method" title="#run (instance method)">- (Object) <strong>run</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Perform the crawl.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#skip_links_like-instance_method" title="#skip_links_like (instance method)">- (Object) <strong>skip_links_like</strong>(*patterns) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Add one ore more Regex patterns for URLs which should not be followed.
</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Arachni/UI/Output.html" title="Arachni::UI::Output (module)">Arachni::UI::Output</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Arachni/UI/Output.html#buffer-instance_method" title="Arachni::UI::Output#buffer (method)">#buffer</a></span>, <span class='object_link'><a href="../Arachni/UI/Output.html#debug%21-instance_method" title="Arachni::UI::Output#debug! (method)">#debug!</a></span>, <span class='object_link'><a href="../Arachni/UI/Output.html#debug%3F-instance_method" title="Arachni::UI::Output#debug? (method)">#debug?</a></span>, <span class='object_link'><a href="../Arachni/UI/Output.html#flush_buffer-instance_method" title="Arachni::UI::Output#flush_buffer (method)">#flush_buffer</a></span>, <span class='object_link'><a href="../Arachni/UI/Output.html#mute%21-instance_method" title="Arachni::UI::Output#mute! (method)">#mute!</a></span>, <span class='object_link'><a href="../Arachni/UI/Output.html#muted%3F-instance_method" title="Arachni::UI::Output#muted? (method)">#muted?</a></span>, <span class='object_link'><a href="../Arachni/UI/Output.html#only_positives%21-instance_method" title="Arachni::UI::Output#only_positives! (method)">#only_positives!</a></span>, <span class='object_link'><a href="../Arachni/UI/Output.html#only_positives%3F-instance_method" title="Arachni::UI::Output#only_positives? (method)">#only_positives?</a></span>, <span class='object_link'><a href="../Arachni/UI/Output.html#print_debug-instance_method" title="Arachni::UI::Output#print_debug (method)">#print_debug</a></span>, <span class='object_link'><a href="../Arachni/UI/Output.html#print_debug_backtrace-instance_method" title="Arachni::UI::Output#print_debug_backtrace (method)">#print_debug_backtrace</a></span>, <span class='object_link'><a href="../Arachni/UI/Output.html#print_debug_pp-instance_method" title="Arachni::UI::Output#print_debug_pp (method)">#print_debug_pp</a></span>, <span class='object_link'><a href="../Arachni/UI/Output.html#print_error-instance_method" title="Arachni::UI::Output#print_error (method)">#print_error</a></span>, <span class='object_link'><a href="../Arachni/UI/Output.html#print_error_backtrace-instance_method" title="Arachni::UI::Output#print_error_backtrace (method)">#print_error_backtrace</a></span>, <span class='object_link'><a href="../Arachni/UI/Output.html#print_info-instance_method" title="Arachni::UI::Output#print_info (method)">#print_info</a></span>, <span class='object_link'><a href="../Arachni/UI/Output.html#print_line-instance_method" title="Arachni::UI::Output#print_line (method)">#print_line</a></span>, <span class='object_link'><a href="../Arachni/UI/Output.html#print_ok-instance_method" title="Arachni::UI::Output#print_ok (method)">#print_ok</a></span>, <span class='object_link'><a href="../Arachni/UI/Output.html#print_status-instance_method" title="Arachni::UI::Output#print_status (method)">#print_status</a></span>, <span class='object_link'><a href="../Arachni/UI/Output.html#print_verbose-instance_method" title="Arachni::UI::Output#print_verbose (method)">#print_verbose</a></span>, <span class='object_link'><a href="../Arachni/UI/Output.html#reroute_to_file-instance_method" title="Arachni::UI::Output#reroute_to_file (method)">#reroute_to_file</a></span>, <span class='object_link'><a href="../Arachni/UI/Output.html#reroute_to_file%3F-instance_method" title="Arachni::UI::Output#reroute_to_file? (method)">#reroute_to_file?</a></span>, <span class='object_link'><a href="../Arachni/UI/Output.html#unmute%21-instance_method" title="Arachni::UI::Output#unmute! (method)">#unmute!</a></span>, <span class='object_link'><a href="../Arachni/UI/Output.html#verbose%21-instance_method" title="Arachni::UI::Output#verbose! (method)">#verbose!</a></span>, <span class='object_link'><a href="../Arachni/UI/Output.html#verbose%3F-instance_method" title="Arachni::UI::Output#verbose? (method)">#verbose?</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Anemone::Core (class)">Core</a></span></tt>) <strong>initialize</strong>(urls, opts = {}) {|_self| ... }
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Initialize the crawl with starting <b>urls</b> (single URL or Array of
URLs) and optional <b>block</b>
</p>


  </div>
</div>
<div class="tags">
  <h3>Yields:</h3>
<ul class="yield">
  
    <li>
      
        <span class='type'>(<tt>_self</tt>)</span>
      
      
      
      
    </li>
  
</ul>
<h3>Yield Parameters:</h3>
<ul class="yieldparam">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Anemone::Core (class)">Anemone::Core</a></span></tt>)</span>
      
      
        <span class='name'>_self</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the object that the method was called on
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


92
93
94
95
96
97
98
99
100
101
102
103
104</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/anemone/core.rb', line 92</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span><span class='lparen'>(</span><span class='id urls'>urls</span><span class='comma'>,</span> <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='ivar'>@urls</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id urls'>urls</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id flatten'>flatten</span><span class='period'>.</span><span class='id map'>map</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id url'>url</span><span class='op'>|</span> <span class='id url'>url</span><span class='period'>.</span><span class='id is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>URI</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id url'>url</span> <span class='op'>:</span> <span class='const'>URI</span><span class='lparen'>(</span><span class='id url'>url</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='ivar'>@urls</span><span class='period'>.</span><span class='id each'>each</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id url'>url</span><span class='op'>|</span> <span class='id url'>url</span><span class='period'>.</span><span class='id path'>path</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span> <span class='kw'>if</span> <span class='id url'>url</span><span class='period'>.</span><span class='id path'>path</span><span class='period'>.</span><span class='id empty?'>empty?</span> <span class='rbrace'>}</span>

  <span class='ivar'>@tentacles</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@on_every_page_blocks</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@on_pages_like_blocks</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id hash'>hash</span><span class='comma'>,</span><span class='id key'>key</span><span class='op'>|</span> <span class='id hash'>hash</span><span class='lbracket'>[</span><span class='id key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
  <span class='ivar'>@skip_link_patterns</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@after_crawl_blocks</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@opts</span> <span class='op'>=</span> <span class='id opts'>opts</span>

  <span class='kw'>yield</span> <span class='kw'>self</span> <span class='kw'>if</span> <span class='id block_given?'>block_given?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <span id="opts-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="opts-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>opts</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Hash of options for the crawl
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


52
53
54</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/anemone/core.rb', line 52</span>

<span class='kw'>def</span> <span class='id opts'>opts</span>
  <span class='ivar'>@opts</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="pages-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="pages-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>pages</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
PageStore storing all Page objects encountered during the crawl
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


50
51
52</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/anemone/core.rb', line 50</span>

<span class='kw'>def</span> <span class='id pages'>pages</span>
  <span class='ivar'>@pages</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="crawl-class_method">
  
    + (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>crawl</strong>(urls, opts = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Convenience method to start a new crawl
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


109
110
111
112
113
114</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/anemone/core.rb', line 109</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id crawl'>crawl</span><span class='lparen'>(</span><span class='id urls'>urls</span><span class='comma'>,</span> <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id urls'>urls</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id core'>core</span><span class='op'>|</span>
    <span class='kw'>yield</span> <span class='id core'>core</span> <span class='kw'>if</span> <span class='id block_given?'>block_given?</span>
    <span class='id core'>core</span><span class='period'>.</span><span class='id run'>run</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="after_crawl-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>after_crawl</strong>(&amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Add a block to be executed on the PageStore after the crawl is finished
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


120
121
122
123</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/anemone/core.rb', line 120</span>

<span class='kw'>def</span> <span class='id after_crawl'>after_crawl</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='ivar'>@after_crawl_blocks</span> <span class='op'>&lt;&lt;</span> <span class='id block'>block</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="focus_crawl-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>focus_crawl</strong>(&amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Specify a block which will select which links to follow on each page. The
block should return an Array of URI objects.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


160
161
162
163</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/anemone/core.rb', line 160</span>

<span class='kw'>def</span> <span class='id focus_crawl'>focus_crawl</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='ivar'>@focus_crawl_block</span> <span class='op'>=</span> <span class='id block'>block</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="on_every_page-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>on_every_page</strong>(&amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Add a block to be executed on every Page as they are encountered during the
crawl
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


138
139
140
141</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/anemone/core.rb', line 138</span>

<span class='kw'>def</span> <span class='id on_every_page'>on_every_page</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='ivar'>@on_every_page_blocks</span> <span class='op'>&lt;&lt;</span> <span class='id block'>block</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="on_pages_like-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>on_pages_like</strong>(*patterns, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Add a block to be executed on Page objects with a URL matching one or more
patterns
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


147
148
149
150
151
152
153
154</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/anemone/core.rb', line 147</span>

<span class='kw'>def</span> <span class='id on_pages_like'>on_pages_like</span><span class='lparen'>(</span><span class='op'>*</span><span class='id patterns'>patterns</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id patterns'>patterns</span>
    <span class='id patterns'>patterns</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id pattern'>pattern</span><span class='op'>|</span>
      <span class='ivar'>@on_pages_like_blocks</span><span class='lbracket'>[</span><span class='id pattern'>pattern</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id block'>block</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="run-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>run</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Perform the crawl
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/anemone/core.rb', line 168</span>

<span class='kw'>def</span> <span class='id run'>run</span>
  <span class='id process_options'>process_options</span>

  <span class='ivar'>@urls</span><span class='period'>.</span><span class='id delete_if'>delete_if</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id url'>url</span><span class='op'>|</span> <span class='op'>!</span><span class='id visit_link?'>visit_link?</span><span class='lparen'>(</span><span class='id url'>url</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='ivar'>@urls</span><span class='period'>.</span><span class='id empty?'>empty?</span>

  <span class='id link_queue'>link_queue</span> <span class='op'>=</span> <span class='const'>Queue</span><span class='period'>.</span><span class='id new'>new</span>
  <span class='id page_queue'>page_queue</span> <span class='op'>=</span> <span class='const'>Queue</span><span class='period'>.</span><span class='id new'>new</span>

  <span class='ivar'>@opts</span><span class='lbracket'>[</span><span class='symbol'>:threads</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id times'>times</span> <span class='kw'>do</span>
    <span class='ivar'>@tentacles</span> <span class='op'>&lt;&lt;</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id new'>new</span> <span class='lbrace'>{</span> <span class='const'>Tentacle</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id link_queue'>link_queue</span><span class='comma'>,</span> <span class='id page_queue'>page_queue</span><span class='comma'>,</span> <span class='ivar'>@opts</span><span class='rparen'>)</span><span class='period'>.</span><span class='id run'>run</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='ivar'>@urls</span><span class='period'>.</span><span class='id each'>each</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id url'>url</span><span class='op'>|</span> <span class='id link_queue'>link_queue</span><span class='period'>.</span><span class='id enq'>enq</span><span class='lparen'>(</span><span class='id url'>url</span><span class='rparen'>)</span> <span class='rbrace'>}</span>

  <span class='id loop'>loop</span> <span class='kw'>do</span>
    <span class='id page'>page</span> <span class='op'>=</span> <span class='id page_queue'>page_queue</span><span class='period'>.</span><span class='id deq'>deq</span>
    <span class='ivar'>@pages</span><span class='period'>.</span><span class='id touch_key'>touch_key</span> <span class='id page'>page</span><span class='period'>.</span><span class='id url'>url</span>
    <span class='id puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id page'>page</span><span class='period'>.</span><span class='id url'>url</span><span class='rbrace'>}</span><span class='tstring_content'> Queue: </span><span class='embexpr_beg'>#{</span><span class='id link_queue'>link_queue</span><span class='period'>.</span><span class='id size'>size</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='ivar'>@opts</span><span class='lbracket'>[</span><span class='symbol'>:verbose</span><span class='rbracket'>]</span>
    <span class='id do_page_blocks'>do_page_blocks</span> <span class='id page'>page</span>
    <span class='id page'>page</span><span class='period'>.</span><span class='id discard_doc!'>discard_doc!</span> <span class='kw'>if</span> <span class='ivar'>@opts</span><span class='lbracket'>[</span><span class='symbol'>:discard_page_bodies</span><span class='rbracket'>]</span>

    <span class='id links'>links</span> <span class='op'>=</span> <span class='id links_to_follow'>links_to_follow</span> <span class='id page'>page</span>
    <span class='id links'>links</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id link'>link</span><span class='op'>|</span>
      <span class='id link_queue'>link_queue</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id link'>link</span><span class='comma'>,</span> <span class='id page'>page</span><span class='period'>.</span><span class='id url'>url</span><span class='period'>.</span><span class='id dup'>dup</span><span class='comma'>,</span> <span class='id page'>page</span><span class='period'>.</span><span class='id depth'>depth</span> <span class='op'>+</span> <span class='int'>1</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
    <span class='ivar'>@pages</span><span class='period'>.</span><span class='id touch_keys'>touch_keys</span> <span class='id links'>links</span>

    <span class='ivar'>@pages</span><span class='lbracket'>[</span><span class='id page'>page</span><span class='period'>.</span><span class='id url'>url</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id page'>page</span>

    <span class='comment'># if we are done with the crawl, tell the threads to end
</span>    <span class='kw'>if</span> <span class='id link_queue'>link_queue</span><span class='period'>.</span><span class='id empty?'>empty?</span> <span class='kw'>and</span> <span class='id page_queue'>page_queue</span><span class='period'>.</span><span class='id empty?'>empty?</span>
      <span class='kw'>until</span> <span class='id link_queue'>link_queue</span><span class='period'>.</span><span class='id num_waiting'>num_waiting</span> <span class='op'>==</span> <span class='ivar'>@tentacles</span><span class='period'>.</span><span class='id size'>size</span>
        <span class='const'>Thread</span><span class='period'>.</span><span class='id pass'>pass</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id page_queue'>page_queue</span><span class='period'>.</span><span class='id empty?'>empty?</span>
        <span class='ivar'>@tentacles</span><span class='period'>.</span><span class='id size'>size</span><span class='period'>.</span><span class='id times'>times</span> <span class='lbrace'>{</span> <span class='id link_queue'>link_queue</span> <span class='op'>&lt;&lt;</span> <span class='symbol'>:END</span> <span class='rbrace'>}</span>
        <span class='kw'>break</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='ivar'>@tentacles</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id thread'>thread</span><span class='op'>|</span> <span class='id thread'>thread</span><span class='period'>.</span><span class='id join'>join</span> <span class='rbrace'>}</span>
  <span class='id do_after_crawl_blocks'>do_after_crawl_blocks</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="skip_links_like-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>skip_links_like</strong>(*patterns) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Add one ore more Regex patterns for URLs which should not be followed
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


129
130
131
132</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/anemone/core.rb', line 129</span>

<span class='kw'>def</span> <span class='id skip_links_like'>skip_links_like</span><span class='lparen'>(</span><span class='op'>*</span><span class='id patterns'>patterns</span><span class='rparen'>)</span>
  <span class='ivar'>@skip_link_patterns</span><span class='period'>.</span><span class='id concat'>concat</span> <span class='lbracket'>[</span><span class='id patterns'>patterns</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id flatten'>flatten</span><span class='period'>.</span><span class='id compact'>compact</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Sun Feb 13 12:47:23 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.4 (ruby-1.9.2).
</div>

  </body>
</html>