
        <div id="page-intro">
            <h2>Dispatchers</h2>
            <p>The dispatchers spawn an XMLRPC server per scan and provide statistics for all running server instances.<br/>
                This interface allows you to "Attach" to (see the output of), pause, resume and shutdown instances.
            </p>

            <form action="/dispatchers/edit" method="get">
                <input type="submit" value="Edit dispatchers" />
            </form>



        </div>
        <%= erb :flash, {:layout => false} %>

        <% stats.each_pair do |d_url, dispatcher_stats| %>
        <h2><%=show_dispatcher_line( dispatcher_stats )%></h2>
        <span class="notice"> <%=show_dispatcher_node_line( dispatcher_stats ) %></span>
        <br/><br/>

        <%if !dispatcher_stats['running_jobs'].empty? %>
        <form action="/dispatchers/<%=remove_proto( d_url.dup )%>/shutdown_all" method="post">
            <%= csrf_tag %>
            <input type="submit" value="Shutdown all" />
        </form>
        <%end%>


        <% if !dispatcher_stats['running_jobs'].empty? %>
        <table>
            <tr>
                <th>PID</th>
                <th>Port</th>
                <th>Owner</th>
                <th>State</th>
                <th>Start time (Server-side)</th>
                <th>Current time (Server-side)</th>
                <th>Runtime</th>
                <th>Memory usage (%)</th>
                <th>CPU usage</th>
                <th>Action</th>
            </tr>
        <% dispatcher_stats['running_jobs'].each do |job| %>
            <tr <%if job_is_slave?( job )%> style='background-color: #ccc'<%end%> >


                <td><%=job['pid']%></td>
                <td><%=job['port']%></td>
                <td><%=escape( job['owner'] )%></td>

                <%if !job['paused'] %>
                    <td>Running</td>
                <% else %>
                    <td>Paused</td>
                <% end %>

                <td><%=job['starttime'].to_time%></td>
                <td><%=job['currtime'].to_time%></td>
                <td><%=secs_to_hms( job['runtime'] )%></td>
                <td><%=proc_mem( job['proc']['rss'] )%> MB (<%=job['proc']['pctmem']%>%)</td>
                <td><%=job['proc']['pctcpu']%>%</td>

                <td>
                    <% if !( job['owner'] =~/WebUI helper/ )%>

                        <% if !job_is_slave?( job ) %>

                            <form action="/instance/<%=port_to_url( job['port'], d_url, true )%>" method="get" target="_blank">
                                <input type="submit" value="Attach" />
                            </form>

                            <%if !job['paused'] %>
                            <form action="/dispatchers/<%=port_to_url( job['port'], d_url, true )%>/pause" method="post">
                                <%= csrf_tag %>
                                <input type="submit" value="Pause" />
                            </form>
                            <%end%>

                            <%if job['paused'] %>
                            <form action="/dispatchers/<%=port_to_url( job['port'], d_url, true )%>/resume" method="post">
                                <%= csrf_tag %>
                                <input type="submit" value="Resume" />
                            </form>
                            <% end %>

                            <form action="/dispatchers/<%=port_to_url( job['port'], d_url, true )%>/shutdown" method="post">
                                <%= csrf_tag %>
                                <input type="submit" value="Shutdown" />
                            </form>

                        <% else %>

                            This is <%=escape( job['owner'] )%>'s slave and is sharing the workload for the <%=escape( job['helpers']['target'] )%> scan.

                        <% end %>

                    <% end %>
                </td>
            </tr>
        <% end %>
        </table>
        <% else %>
        <span class="notice"> There are no running scans at the moment.</span>
        <% end %>

        <br/><br/>

        <% end %>
